import{g as K,r,o as c,a as y,b as l,w as v,s as h,e as g,_ as R,k as u,j as ce,h as re,m as de,f as j,l as x,q as me,d as n,y as P,p as D,G as pe,F as ve,t as q,B as M,A as fe}from"../index58703.js";import{u as _e}from"./useAudienceStore58703.js";import{u as ye}from"./useComponyStore58703.js";import{u as ge,P as be}from"./PaginatedAutoComplete58703.js";import"./common-service58703.js";const Ce={key:0},we=K({__name:"ContactsTable",props:{contacts:{type:Array,required:!1}},setup(V){return(S,f)=>{const _=r("Column"),F=r("DataTable");return V.contacts?(c(),y("div",Ce,[l(F,{value:V.contacts,lazy:!1,paginator:!0,rows:30,ref:"dt",dataKey:"id",stateStorage:"local",stateKey:"dt-campaigns",removableSort:""},{empty:v(()=>[...f[0]||(f[0]=[h(" Nessun referente trovato.",-1)])]),default:v(()=>[l(_,{field:"email",header:"Email",ref:"email"},null,512),l(_,{field:"first_name",header:"Nome",ref:"name"},null,512),l(_,{field:"last_name",header:"Cognome",ref:"surname"},null,512)]),_:1},8,["value"])])):g("v-if",!0)}}}),xe=R(we,[["__file","/opt/atlassian/pipelines/agent/build/src/components/tables/ContactsTable.vue"]]),he={class:"m-4"},Ae={class:"flex align-items-center justify-content-between"},Be={class:"flex align-items-center justify-content-between mx-0"},ke={class:"field col-4 px-0"},Te={key:0,id:"name",class:"p-error"},De={class:"field col-4 p-0 m-0 mb-3"},Ve={key:0,id:"company",class:"p-error"},Fe={class:"flex align-items-center justify-content-between"},Me={key:0,class:"m-0 p-0 list-none"},Se={class:"flex align-items-center"},Ne=["onClick"],Ue={class:"flex justify-content-end mt-3"},ze=K({__name:"AudienceDetailView",setup(V){const S=u({icon:"pi pi-home",to:"/audience"}),f=u(!1),_=u([{label:""}]),F=ce(),d=re(),m=u(new Array),C=u(!1),w=u(!1),A=_e(),$=ye(),p=u(),t=u({}),B=u(),{showLoader:k,hideLoader:T}=me(),G=async function(a){try{return await $.fetchAllCompanies({page:a.page,limit:a.limit,name_like:a.query||void 0})}catch(e){x(d,e)}},{data:N,fetchInit:Y,fetchMore:Z,isLoading:H}=ge(G,"companies"),J=async function(a){k();try{t.value=await A.fetchAudienceDetail(a),p.value=t.value.company}catch(e){x(d,e)}finally{T()}},O=()=>{f.value=!0},Q=()=>{f.value=!1},W=a=>{if(a===0)return"0 B";let e=1e3,i=3,s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],b=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,b)).toFixed(i))+" "+s[b]},X=a=>{m.value=a.files},ee=function(a){m.value.splice(a,1)},U=async function(){var a;if(!!((a=t.value)!=null&&a.id)){k();try{t.value=await A.importContacts(t.value.id,m.value[0]),m.value=[],M(d,{message:"File caricato correttamente.",title:""}),Q()}catch(e){x(d,e)}finally{T()}}},z=function(){var a;return(a=t.value)!=null&&a.name?C.value=!1:C.value=!0,C.value},E=function(){return p.value?w.value=!1:w.value=!0,w.value},ae=function(){z()||E()||(B.value&&t.value?ne():te())},te=async function(){var e,i,s;k();const a={name:(e=t==null?void 0:t.value)==null?void 0:e.name,company_id:(i=p.value)==null?void 0:i.id};try{t.value=await A.createAudience(a),(s=t.value)!=null&&s.id&&await fe.replace({name:"dettaglio-audience",params:{id:t.value.id}}),M(d,{message:"Audience creato correttamente.",title:""})}catch(b){x(d,b)}finally{T()}},ne=async function(){var e,i;if(!((e=t==null?void 0:t.value)!=null&&e.id))return;k();const a={name:t.value.name,company_id:(i=p==null?void 0:p.value)==null?void 0:i.id};try{await A.updateAudience(t.value.id,a),M(d,{message:"Audience aggiornato correttamente.",title:""})}catch(s){x(d,s)}finally{T()}};function oe(a){p.value=a,E()}return de(async()=>{B.value=F.params.id,B.value?(await J(B.value),_.value[0]={label:"Modifica audience"}):_.value[0]={label:"Nuova audience"}}),(a,e)=>{var I;const i=r("Breadcrumb"),s=r("Button"),b=r("InputText"),L=r("Card"),le=r("Message"),se=r("FileUpload"),ie=r("Dialog");return c(),y("div",he,[l(i,{home:S.value,model:_.value,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),l(L,null,{content:v(()=>[n("div",Ae,[e[6]||(e[6]=n("h1",{class:"mb-3"},"AUDIENCE",-1)),l(s,{class:"",label:"Salva",onClick:ae})]),n("div",Be,[g(" <h1>{{ audience_detail.name }}</h1> "),n("div",ke,[e[7]||(e[7]=n("label",{for:"name"},"Nome audience*",-1)),l(b,{id:"name",type:"text",modelValue:t.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.name=o),class:P(["w-full",{"p-invalid":C.value}]),onChange:z},null,8,["modelValue","class"]),C.value?(c(),y("small",Te,"Campo obbligatorio.")):g("v-if",!0)])]),n("div",De,[e[8]||(e[8]=n("label",{for:"company"},"Azienda*",-1)),l(be,{id:"company","model-value":p.value,suggestions:D(N),class:P({"p-invalid":w.value}),"onUpdate:suggestions":e[1]||(e[1]=o=>N.value=o),"onUpdate:modelValue":oe,onFirstFetch:e[2]||(e[2]=o=>D(Y)(o)),onFetchMore:e[3]||(e[3]=o=>D(Z)(o)),"is-loading":D(H)},null,8,["model-value","suggestions","class","is-loading"]),w.value?(c(),y("small",Ve,"Campo obbligatorio.")):g("v-if",!0)])]),_:1}),(I=t.value)!=null&&I.id?(c(),j(L,{key:0,class:"mt-4"},{content:v(()=>[n("div",Fe,[e[14]||(e[14]=n("h1",null,"Contatti",-1)),n("div",null,[e[13]||(e[13]=n("a",{href:"https://wala.s3-eu-central-1.amazonaws.com/wala_template_import_audience.xlsx",class:"p-button mr-4 p-button-outlined",icon:"pi pi-download"},[n("i",{class:"pi pi-download mr-2"}),h(" TEMPLATE ")],-1)),l(s,{class:"",label:"carica",icon:"pi pi-upload",onClick:O}),l(ie,{header:"CARICA FILE",visible:f.value,"onUpdate:visible":e[5]||(e[5]=o=>f.value=o),style:{width:"500px"}},{default:v(()=>[t.value.audience_users&&t.value.audience_users.length>0?(c(),j(le,{key:0,severity:"warn"},{default:v(()=>[...e[9]||(e[9]=[h("Attenzione! Importando un nuovo file i contatti presenti verrano sovrascritti. ",-1)])]),_:1})):g("v-if",!0),l(se,{name:"files[]",onUploader:U,multiple:!1,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:2e6,customUpload:!0,modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=o=>m.value=o),onSelect:X},{content:v(()=>[m.value?(c(),y("ul",Me,[(c(!0),y(pe,null,ve(m.value,(o,ue)=>(c(),y("li",{key:o.name,class:"flex align-items-center p-fileupload-file justify-content-between"},[n("div",Se,[e[10]||(e[10]=n("i",{class:"pi mr-2 document-icon"},null,-1)),h(" "+q(o.name),1),e[11]||(e[11]=n("br",null,null,-1)),h(" "+q(W(o.size)),1)]),n("i",{class:"pi pi-times p-button-icon text-red-600 cursor-pointer font-semibold",onClick:Ee=>ee(ue)},null,8,Ne)]))),128))])):g("v-if",!0)]),empty:v(()=>[...e[12]||(e[12]=[n("div",{class:"text-center"},[n("b",null,"Trascina qui il documento"),n("p",{class:"text-xs"},"(Dimensione massima 20 MB)")],-1)])]),_:1},8,["modelValue"]),n("div",Ue,[l(s,{class:"p-button-outlined",label:"carica",icon:"pi pi-upload",onClick:U})])]),_:1},8,["visible"])])]),l(xe,{contacts:t.value.audience_users},null,8,["contacts"])]),_:1})):g("v-if",!0)])}}}),Ke=R(ze,[["__file","/opt/atlassian/pipelines/agent/build/src/views/audience/AudienceDetailView.vue"]]);export{Ke as default};
