import{g as oe,h as le,i as ne,c as B,k as ie,l as m,n as re,a4 as ce,a5 as K,r as v,p as de,a as r,b as d,d as t,w as b,t as _,s as w,I as $,G as L,e as u,m as S,L as ue,B as pe,o as i,q as F,f as T,a6 as _e,z as M,a7 as me,_ as ve}from"./index.5000a42e.js";import{u as be}from"./useReportStore.a6a364b2.js";const he="/assets/user.b9720051.svg",fe="/assets/thumbs-up.15659a96.svg",ge="/assets/hourglass.7cad29e8.svg",we="/assets/thumbs-down.ef5882ca.svg",xe=function(z){return z.params.id!==void 0?z.params.id:""},ye={class:"dashboard"},ke={class:"mb-3"},Ee={class:"container"},Re={class:"col-12 flex align-items-center justify-content-between pb-0"},Ce={class:"flex"},De={key:0,class:"text-white mt-0"},Be={key:1,class:"text-white mt-0"},$e={key:0,class:"col-12 flex align-items-center"},Le={class:"text-white mt-0"},Te={key:1,class:"col-12 flex align-items-center"},ze={class:"text-white mt-0"},Ve={key:0,class:"grid justify-content-center align-items-end flex-wrap border-round-sm"},Ae={class:"col-12"},Ie={class:"container"},Se={class:"flex align-items-center justify-content-between flex-wrap"},Fe={class:"counter-block border-round-2xl p-3"},Me={class:"text-white m-0"},Oe={class:"counter-block border-round-2xl p-3"},Pe={class:"text-white m-0"},je={class:"counter-block border-round-2xl p-3"},Ue={class:"text-white m-0"},He={class:"counter-block border-round-2xl p-3"},Ne={class:"text-white m-0"},qe={class:"col-12 pl-0 ml-0 mb-0"},Ge={class:"flex justify-content-end mt-0 mb-2"},Qe={class:"wrapper-charts"},We={class:"flex"},Je={class:""},Ke={key:0,class:"flex row-gap-3 flex-column"},Xe={class:"text-center font-semibold"},Ye=["innerHTML"],Ze={class:"pi pi-info-circle cursor-pointer"},et={key:0,class:"flex flex-wrap"},tt={class:"text-center font-semibold"},at=["innerHTML"],st={class:"pi pi-info-circle cursor-pointer"},ot={class:"text-center font-semibold"},lt=["innerHTML"],nt={class:"pi pi-info-circle cursor-pointer"},it=oe({__name:"ReportView",setup(z){const y=le(),V=ne(),A=be(),{showLoader:X,hideLoader:k}=ue(),a=B(()=>A.currentReport),O=B(()=>y.getters["auth/isUserSuperAdmin"]),P=B(()=>y.getters["auth/isUserAdmin"]),E=ie(),j=m({icon:"pi pi-home",to:"/campagne"}),Y=m([{label:"Report"}]),U=["Carichi di cura","Economico - Finanziarie","Salute e benessere","Mobilit\xE0 e trasporto","Formazione","Tempo libero"],R=m(),x=m(),h=m(),H=B(()=>({chartData:{datasets:[{data:a.value!=null?a.value.sections:[],backgroundColor:["#cd1867","#DB4CB3","#EABB3D","#B958D8","#a1c653","#009265"]}],labels:U},chartOptions:{maintainAspectRatio:.5,plugins:{legend:{display:!1},tooltip:{callbacks:{label:s=>`${s.formattedValue}`}}},scales:{y:{ticks:{display:!1}}}}})),C=m(),N=m([{label:"Et\xE0",code:"age",items:[]},{label:"Et\xE0 figli",code:"child",items:[{label:"0-2",value:"child_age_0_2"},{label:"3-6",value:"child_age_3_6"},{label:"7-11",value:"child_age_7_11"},{label:"12-14",value:"child_age_12_14"},{label:"15-18",value:"child_age_15_18"},{label:"18+",value:"child_age_over_18"}]},{label:"Genere",code:"genre",items:[{label:"Maschio",value:"male"},{label:"Femmina",value:"female"},{label:"Altro/Preferisco non rispondere",value:"other"}]}]),Z=async function(s,e){try{const o=await A.fetchReportDetail(s,e);return A.isNewReport&&pe.replace({name:"dettaglio-report-v2",params:{id:s}}),Q(),G(),J(),o}catch(o){k(),S(V,o)}},q=async function(){x.value=xe(E);const s={};if(C.value&&(s.filter=C.value),x.value!="")if(E.name=="dettaglio-report")j.value={icon:"pi pi-home",to:"/reports"},await Z(x.value,s);else try{const e=await y.dispatch(K.SHOW,s);return Q(),G(),J(),e}catch(e){k(),S(V,e)}},G=()=>{h.value=[],a.value.answers[0].forEach(s=>{h.value.push(ee(s))})},ee=s=>{const e=[],o=[];if(a.value)return s.answers.forEach(l=>{e.push(l.total),o.push(l.showrt_answer_label)}),{chartData:{datasets:[{data:e,backgroundColor:["#6EF0D2","#DB4CB3","#EABB3D","#F0A68F"]}],labels:o},chartOptions:{indexAxis:"y",maintainAspectRatio:.5,plugins:{title:{display:!1,text:`${s.question_label} - Rispondenti: ${s.answer_count} su ${a.value.completed}`},legend:{display:!1},tooltip:{callbacks:{label:()=>"",title:l=>[`${e[l[0].dataIndex]} risposte`,`${Math.round(e[l[0].dataIndex]*100/s.answer_count)}% del campione`,`${Math.round(e[l[0].dataIndex]*100/a.value.completed)}% del totale`]}}}},question:`${s.question_label} - Rispondenti: ${s.answer_count} su ${a.value.completed} `}},te=(s,e)=>{const o=[],l=[],c=[];if(a.value)return s.answers.forEach(p=>{o.push(p.total),c.push(p.showrt_answer_label),l.push(p.answer_label),s.answer_count*100/a.value.completed}),{chartData:{datasets:[{data:o,backgroundColor:e}],labels:c},chartOptions:{maintainAspectRatio:.5,plugins:{title:{display:!0},legend:{display:!1},tooltip:{callbacks:{label:()=>"",title:p=>[`${l[p[0].dataIndex]}`,`${o[p[0].dataIndex]} risposte`,`${Math.round(o[p[0].dataIndex]*100/s.answer_count)}% del campione`,`${Math.round(o[p[0].dataIndex]*100/a.value.completed)}% del totale`]}}}},question:`${s.question_label} <br> Rispondenti: ${s.answer_count} su ${a.value.completed} `}},Q=()=>{var s;if(R.value=[],U.forEach(e=>{let o={title:e,content:[]};R.value.push(o)}),(s=a.value)!=null&&s.answers)for(let e in a.value.answers)switch(+e){case 1:{f(e,"#cd1867",0);break}case 2:f(e,"#DB4CB3",1);break;case 3:f(e,"#EABB3D",2);break;case 4:f(e,"#B958D8",3);break;case 5:f(e,"#a1c653",4);break;case 6:f(e,"#009265",5);break}},f=(s,e,o)=>{a.value.answers[s].forEach(l=>{R.value[o].content.push(te(l,e))})},W=async function(s){if(!a.value)return;let e="";s?e=`/reports/${x.value}/download_report`:e=`/campaigns/${x.value}/download_report`,X();try{const l=await me({method:"get",url:e,responseType:"blob",timeout:6e4});var o=new Blob([l.data],{type:l.headers["content-type"]});const c=document.createElement("a");c.href=window.URL.createObjectURL(o),s?c.download=`report_${a.value.report_title.replace(/\s/g,"_").toLocaleLowerCase()}.xlsx`:c.download=`report_${a.value.campaign_name.replace(/\s/g,"_").toLocaleLowerCase()}.xlsx`,c.click(),k()}catch(l){k(),S(V,l)}},J=function(){const s=a.value.answers[0][0].answers;N.value[0].items=[{label:s[0].answer_label,value:"18-34"},{label:s[1].answer_label,value:"35-54"},{label:s[2].answer_label,value:"55-64"},{label:s[3].answer_label,value:"65+"}]};return re(()=>{q()}),ce(()=>{y.dispatch(K.RESET_REPORT)}),(s,e)=>{const o=v("Breadcrumb"),l=v("Button"),c=v("Card"),p=v("Dropdown"),D=v("Chart"),ae=v("TabPanel"),se=v("TabView"),I=de("tooltip");return i(),r("div",ye,[d(o,{home:j.value,model:Y.value,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),t("div",ke,[d(c,{class:"box py-2"},{content:b(()=>{var n;return[t("div",Ee,[t("div",Re,[t("div",Ce,[e[4]||(e[4]=t("h3",{class:"text-white m-0 mr-3"},"Questionario",-1)),a.value&&a.value.campaign_name?(i(),r("span",De,_(a.value.campaign_name),1)):u("v-if",!0),a.value&&a.value.report_title?(i(),r("span",Be,_(a.value.report_title),1)):u("v-if",!0)]),u(" Pulsante di downlodad visibile per le campagne "),(P.value||O.value)&&F(E).name!="dettaglio-report"?(i(),T(l,{key:0,class:"p-button-outlined p-button-secondary",label:"Scarica Report",onClick:e[0]||(e[0]=g=>W(!1)),disabled:F(_e)((n=a.value)==null?void 0:n.campaign_start_at)},null,8,["disabled"])):u("v-if",!0),u(" Pulsante di downlodad visibile per i report "),(P.value||O.value)&&F(E).name=="dettaglio-report"?(i(),T(l,{key:1,class:"p-button-outlined p-button-secondary",label:"Scarica Report",onClick:e[1]||(e[1]=g=>W(!0))})):u("v-if",!0)]),a.value&&a.value.campaign_start_at?(i(),r("div",$e,[e[5]||(e[5]=t("h3",{class:"text-white m-0 mr-3"},"Inizio",-1)),t("span",Le,_(a.value.campaign_start_at),1)])):u("v-if",!0),a.value&&a.value.campaign_end_at?(i(),r("div",Te,[e[6]||(e[6]=t("h3",{class:"text-white m-0 mr-3"},"Scadenza",-1)),t("span",ze,_(a.value.campaign_end_at),1)])):u("v-if",!0)])]}),_:1})]),a.value?(i(),r("div",Ve,[t("div",Ae,[t("div",Ie,[e[14]||(e[14]=t("h3",null,"Fruizione questionario",-1)),t("div",Se,[t("div",Fe,[t("h2",Me,_(a.value.total),1),e[7]||(e[7]=t("div",{class:"flex align-items-center justify-content-between"},[w(" Iscritti "),t("img",{src:he,class:"h-2rem"})],-1))]),t("div",Oe,[t("h2",Pe,_(a.value.completed),1),e[8]||(e[8]=t("div",{class:"flex align-items-center justify-content-between"},[w(" Concluso "),t("img",{src:fe,class:"h-2rem"})],-1))]),t("div",je,[t("h2",Ue,_(a.value.started),1),e[9]||(e[9]=t("div",{class:"flex align-items-center justify-content-between"},[w(" Iniziato "),t("img",{src:ge,class:"h-2rem"})],-1))]),t("div",He,[t("h2",Ne,_(a.value.total-a.value.completed-a.value.started),1),e[10]||(e[10]=t("div",{class:"flex align-items-center justify-content-between"},[w(" Non iniziato "),t("img",{src:we,class:"h-2rem"})],-1))])]),t("div",qe,[e[11]||(e[11]=t("h3",{class:"mb-0"},"Risultati",-1)),t("div",Ge,[d(p,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=n=>C.value=n),options:N.value,optionLabel:"label",optionValue:"value",optionGroupLabel:"label",optionGroupChildren:"items",placeholder:"Filtra per et\xE0 o genere",onChange:e[3]||(e[3]=n=>q()),showClear:!0},null,8,["modelValue","options"])])]),t("div",Qe,[t("div",We,[d(c,null,{content:b(()=>[t("div",Je,[t("div",null,[e[12]||(e[12]=t("h3",{class:"mt-3"},"Bisogni",-1)),e[13]||(e[13]=t("p",{class:"mb-6 font-italic line-height-2"},[w(" I punteggi assegnati alle singole aree previste dal grafico indicano l\u2019intensit\xE0 di bisogno rilevata nella popolazione aziendale. Pi\xF9 alto il punteggio, maggiore l\u2019intensit\xE0 di bisogno rilevata nella specifica area."),t("br"),w(" Si noti bene che il punteggio non si riferisce ad una porzione percentuale della popolazione aziendale. ")],-1)),d(D,{type:"bar",data:H.value.chartData,options:H.value.chartOptions},null,8,["data","options"])])])]),_:1})]),h.value?(i(),r("div",Ke,[(i(!0),r($,null,L(h.value.slice(0,2),n=>(i(),T(c,{key:n},{content:b(()=>[t("div",Xe,[t("span",{innerHTML:n.question,class:"line-height-3"},null,8,Ye),M(t("i",Ze,null,512),[[I,"Il questionario \xE8 adattivo e mostra le domande solo agli utenti in target. La domanda \xE8 stata posta ad un campione selezionato di utenti. Passando il mouse sul grafico \xE8 possibile accedere alle statistiche di approfondimento.",void 0,{top:!0}]])]),d(D,{type:"bar",data:n.chartData,options:n.chartOptions},null,8,["data","options"])]),_:2},1024))),128))])):u("v-if",!0)]),h.value?(i(),r("div",et,[(i(!0),r($,null,L(h.value.slice(2),n=>(i(),r("div",{class:"col-6",key:n},[d(c,null,{content:b(()=>[t("div",tt,[t("span",{innerHTML:n.question,class:"line-height-3"},null,8,at),M(t("i",st,null,512),[[I,"Il questionario \xE8 adattivo e mostra le domande solo agli utenti in target. La domanda \xE8 stata posta ad un campione selezionato di utenti. Passando il mouse sul grafico \xE8 possibile accedere alle statistiche di approfondimento.",void 0,{top:!0}]])]),d(D,{type:"bar",data:n.chartData,options:n.chartOptions},null,8,["data","options"])]),_:2},1024)]))),128))])):u("v-if",!0),d(c,{class:"mt-4"},{content:b(()=>[d(se,null,{default:b(()=>[(i(!0),r($,null,L(R.value,n=>(i(),T(ae,{key:n.title,header:n.title},{default:b(()=>[(i(!0),r($,null,L(n.content,g=>(i(),r("div",{key:g,class:"my-4 xs:col-12 xs:col-offset-0 lg:col-8 lg:col-offset-2"},[t("div",ot,[t("span",{innerHTML:g.question,class:"line-height-3"},null,8,lt),M(t("i",nt,null,512),[[I,"Il questionario \xE8 adattivo e mostra le domande solo agli utenti in target. La domanda \xE8 stata posta ad un campione selezionato di utenti. Passando il mouse sul grafico \xE8 possibile accedere alle statistiche di approfondimento.",void 0,{top:!0}]])]),d(D,{type:"bar",data:g.chartData,options:g.chartOptions},null,8,["data","options"])]))),128))]),_:2},1032,["header"]))),128))]),_:1})]),_:1})])])])):u("v-if",!0)])}}});const dt=ve(it,[["__scopeId","data-v-28b2f32a"],["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/views/reports/ReportView.vue"]]);export{dt as default};
