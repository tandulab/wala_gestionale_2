import{g as H,h as z,i as Q,j as W,l as S,c as g,m as V,n as X,r as s,p as Y,a as h,b as o,w as l,q as d,o as v,s as k,v as M,t as K,z as D,f as Z,e as B,B as ee,C as te,_ as E,K as oe,d as F}from"../index35192.js";import{u as ae}from"./useAudienceStore35192.js";import{T as N,u as ne}from"./useLazyData35192.js";import{h as se}from"./loader35192.js";import"./common-service35192.js";const le=H({__name:"AudienceTable",setup(p){const i=z(),m=Q(),f=W(),A=S(),r=ae(),c=S({name:{value:"",matchMode:N.LIKE},"company.name":{value:"",matchMode:N.LIKE}}),{onSort:_,onPage:w,loadLazyData:y,isLoading:I,onFilter:U,tableRows:$}=ne({rows:30},R,localStorage.getItem("new-dt-audiences")?JSON.parse(localStorage.getItem("new-dt-audiences")):void 0),L=g(()=>r.currentAudiences),P=g(()=>r.currentAudiencesTotal);async function R(n){try{await r.fetchAllAudiences(n)}catch(t){V(m,t)}finally{await se(i)}}const q=async function(n){try{await r.deleteAudience(n),te(m,{message:"Audience eliminato correttamente.",title:""}),await y()}catch(t){V(m,t)}},G=(n,t)=>{!t||f.require({target:n.currentTarget,message:"Sei sicuro di voler eliminare questo audience?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{q(t)}})},O=function(n){ee.push({name:"dettaglio-audience",params:{id:n.id}})};return X(()=>{y()}),(n,t)=>{const C=s("InputText"),b=s("Column"),T=s("Button"),j=s("DataTable"),J=s("ConfirmPopup"),x=Y("tooltip");return v(),h("div",null,[o(j,{value:L.value,totalRecords:P.value,lazy:!0,paginator:!0,rows:d($),filters:c.value,"onUpdate:filters":t[0]||(t[0]=e=>c.value=e),ref_key:"dt",ref:A,dataKey:"id",loading:d(I),onPage:t[1]||(t[1]=e=>d(w)(e)),onSort:t[2]||(t[2]=e=>d(_)(e)),onFilter:t[3]||(t[3]=()=>d(U)(c.value)),filterDisplay:"row",stateStorage:"local",stateKey:"new-dt-audiences",removableSort:""},{empty:l(()=>[...t[4]||(t[4]=[k(" Nessun audience trovato.",-1)])]),default:l(()=>[o(b,{field:"name",header:"Nome",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:l(({filterModel:e,filterCallback:a})=>[o(C,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onKeydown:M(u=>a(),["enter"]),class:"p-column-filter",placeholder:"Filtra per nome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),o(b,{field:"company.name",header:"Azienda",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:l(({data:e})=>{var a;return[k(K((a=e.company)==null?void 0:a.name),1)]}),filter:l(({filterModel:e,filterCallback:a})=>[o(C,{type:"text",modelValue:e.value,"onUpdate:modelValue":u=>e.value=u,onKeydown:M(u=>a(),["enter"]),class:"p-column-filter",placeholder:"Filtra per azienda"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),o(b,{header:"",style:{width:"9rem"}},{body:l(({data:e})=>[e.id?D((v(),Z(T,{key:0,type:"button",onClick:a=>O(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil",disabled:!e.can_edit},null,8,["onClick","disabled"])),[[x,"Modifica",void 0,{top:!0}]]):B("v-if",!0),D(o(T,{type:"button",onClick:a=>G(a,e.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200",icon:"pi pi-trash",disabled:!e.can_delete},null,8,["onClick","disabled"]),[[x,"Elimina",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","rows","filters","loading"]),o(J)])}}}),ie=E(le,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/components/tables/AudienceTable.vue"]]),re={setup(){const p=z();return{audiences:g(()=>p.getters[oe.CURRENT_CAMPAIGNS])}},components:{AudienceTable:ie}},ce={class:"flex justify-content-between align-items-center"},ue={key:0,class:"uppercase"};function de(p,i,m,f,A,r){const c=s("Button"),_=s("AudienceTable"),w=s("Card");return v(),h("div",null,[o(w,null,{content:l(()=>[F("div",ce,[f.audiences?(v(),h("h1",ue,[F("span",null,K(f.audiences.total)+" Audience",1)])):B("v-if",!0),o(c,{label:"Nuovo audience",onClick:i[0]||(i[0]=y=>p.$router.push("/dettaglio-audience"))})]),o(_)]),_:1})])}const we=E(re,[["render",de],["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/views/audience/AudienceView.vue"]]);export{we as default};
