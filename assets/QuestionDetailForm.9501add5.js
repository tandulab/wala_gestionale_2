import{T as B,U as M,V as O,W as F,X as f,D as G,l as h,c as I,E as T,g as Y,i as Z,n as ee,r as w,p as te,a as Q,b as r,d as n,w as V,m as k,L as se,o as D,I as j,y as z,e as E,t as C,G as ae,s as ne,z as oe,C as P,_ as ie}from"./index.5000a42e.js";class S{static async fetchAll(e){return(await B("/questions",e)).data}static async getQuestionDetail(e){return(await B(`/questions/${e}`)).data.question}static async createQuestion(e){return(await M("/questions",e.formData)).data.question}static async deleteQuestion(e){return(await O(`/questions/${e}`)).data}static async updateQuestion(e){return(await F(`/questions/${e.question.id}`,e)).data.question}static async updateQuestionLabel(e){return(await F(`/question_labels/${e.label_id}`,e)).data.question}static async fetchAllQuestions(e){return(await B(`/campaigns/${e}/questionnaire`)).data}static async fetchAllQuestionsV2(e){return await f.get(`/campaigns/${e}/questionnaire`)}static async fetchQuestionDetailV2(e){return(await f.get(`/questions/${e}`)).question}static async updateQuestionV2(e,a){return(await f.patch(`/questions/${e}`,a)).question}static async fetchBaseQuestionDetail(e){return(await f.get(`/base_questions/${e}`)).base_question}static async updateBaseQuestion(e,a){return(await f.patch(`/base_questions/${e}`,a)).question}}const Ae=G("question-store",()=>{const i=h(null),e=h(null),a=I(()=>i.value),s=I(()=>e.value);async function b(u){try{i.value=await S.fetchQuestionDetailV2(u)}catch(c){console.error(c)}}async function v(u){try{return e.value=await S.fetchBaseQuestionDetail(u),e.value}catch(c){console.error(c)}}async function g(u,c){try{return i.value=await S.updateQuestionV2(u,c),i.value}catch(A){console.error(A)}}async function m(u,c){try{e.value=await S.updateBaseQuestion(u,c)}catch(A){console.error(A)}}function p(){i.value=null}return{question:T(i),baseQuestion:T(e),getCurrentQuestion:a,getCurrentBaseQuestion:s,fetchQuestionDetail:b,fetchBaseQuestionDetail:v,updateQuestion:g,updateBaseQuestion:m,$reset:p}});class N{static async fetchAll(e){return(await B("/answers",e)).data}static async getAnswerDetail(e){return(await B(`/answers/${e}`)).data.answer}static async createAnswer(e){return(await M("/answers",e.formData)).data.answer}static async deleteAnswer(e){return(await O(`/answers/${e}`)).data}static async updateAnswer(e){return(await F(`/answers/${e.answer.id}`,e)).data.answer}static async updateAnswerLabel(e){return(await F(`/answer_labels/${e.answer_id}`,e)).data.answer_label}static async fetchAnswerDetailV2(e){return(await f.get(`/answers/${e}`)).answer}static async updateAnswerV2(e,a){return(await f.patch(`/answers/${e}`,a)).answer}static async updateBaseAnswer(e,a){return(await f.patch(`/base_answers/${e}`,a)).answer}}const xe=G("answer-store",()=>{const i=h(null),e=h(null),a=I(()=>i.value),s=I(()=>e.value);async function b(p){try{i.value=await N.fetchAnswerDetailV2(p)}catch(u){console.error(u)}}async function v(p,u){try{return i.value=await N.updateAnswerV2(p,u),i.value}catch(c){console.error(c)}}async function g(p,u){try{return e.value=await N.updateBaseAnswer(p,u),e.value}catch(c){console.error(c)}}function m(){i.value=null}return{answer:T(i),baseAnswer:T(e),currentAnswer:a,currentBaseAnswer:s,fetchAnswerDetail:b,updateAnswer:v,updateBaseAnswer:g,$reset:m}}),le={class:"m-4"},re={class:"flex flex-wrap"},ue={class:"col-6 flex-1"},ce={class:"flex align-items-center justify-content-between mt-2 mb-4"},de={class:"formgrid grid col-12 flex flex-column"},pe={class:"field"},we={class:"field flex flex-column"},ve={class:"field flex flex-column"},me={class:"flex justify-content-end"},fe={class:"col-6 flex-1"},ye={class:"flex flex-column preview"},_e={class:"mb-0"},he={class:"mt-2"},be={key:0},ge={key:0,class:"pi pi-info-circle"},qe={class:"col-12"},Qe={class:"formgrid grid col-12 flex flex-column"},Ve=Y({__name:"QuestionDetailForm",props:{questionId:{type:String,required:!0},home:{type:Object,required:!0},items:{type:Array,required:!0},fetchQuestion:{type:Function,required:!0},updateQuestionFn:{type:Function,required:!0},updateAnswerFn:{type:Function,required:!0},getQuestionDetail:{type:Function,required:!0}},setup(i){const e=i,a=Z(),s=h({}),b=h([]),v=h(!1),{showLoader:g,hideLoader:m}=se(),p=async function(){var t,y,d,q;if(c()||!e.questionId)return;g();const l={description:(t=s.value.description)!=null?t:void 0,title:(y=s.value.title)!=null?y:void 0,tooltip:(d=s.value.tooltip)!=null?d:void 0,enabled:(q=s.value.enabled)!=null?q:void 0};try{const _=await e.updateQuestionFn(e.questionId,l);return P(a,{message:"Domanda aggiornata correttamente.",title:""}),m(),_}catch(_){m(),k(a,_)}},u=function(){const l=e.getQuestionDetail();l&&(s.value={...l})},c=function(){var l,t;return((l=s.value)==null?void 0:l.description)==""||((t=s.value)==null?void 0:t.description)==null?v.value=!0:v.value=!1,v.value},A=async function(l){var y;if(c())return;g();const t={label:l.label,tooltip:l.tooltip};try{const d=await e.updateAnswerFn(l.id,t);return d?(P(a,{message:"Risposta aggiornata correttamente.",title:""}),(y=s.value.answers)==null||y.forEach((q,_)=>{q.id==l.id&&s.value.answers&&(s.value.answers[_]=d)}),d):void 0}catch(d){k(a,d)}finally{m()}},W=l=>{let{newData:t}=l;A(t)},K=async function(l){try{return await e.fetchQuestion(l)}catch(t){m(),k(a,t)}};return ee(async()=>{e.questionId&&(await K(e.questionId),u())}),(l,t)=>{const y=w("Breadcrumb"),d=w("Badge"),q=w("InputSwitch"),_=w("Textarea"),$=w("InputText"),X=w("Button"),U=w("Card"),L=w("Column"),H=w("DataTable"),J=te("tooltip");return D(),Q("div",le,[r(y,{home:i.home,model:i.items,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),n("div",re,[n("div",ue,[r(U,{class:"h-full"},{content:V(()=>[n("div",ce,[t[5]||(t[5]=n("h1",{class:"m-0 p-0"},"DOMANDA",-1)),s.value.survey_code==="impact"?(D(),Q(j,{key:0},[r(d,{value:s.value.enabled?"Attiva":"Disattivata",class:z(["uppercase border-noround ml-auto mr-2",s.value.enabled?"active":"finished"])},null,8,["value","class"]),r(q,{modelValue:s.value.enabled,"onUpdate:modelValue":t[0]||(t[0]=o=>s.value.enabled=o)},null,8,["modelValue"])],64)):E("v-if",!0)]),n("div",de,[n("div",pe,[t[6]||(t[6]=n("label",{for:"note"},"Domanda",-1)),r(_,{id:"note",modelValue:s.value.description,"onUpdate:modelValue":t[1]||(t[1]=o=>s.value.description=o),rows:"5",cols:"30",class:z(["w-full",{"p-invalid":v.value}]),onChange:c},null,8,["modelValue","class"])]),n("div",we,[t[7]||(t[7]=n("label",{for:"note"},"Titolo",-1)),r($,{type:"text",modelValue:s.value.title,"onUpdate:modelValue":t[2]||(t[2]=o=>s.value.title=o),class:"p-column-filter"},null,8,["modelValue"])]),n("div",ve,[t[8]||(t[8]=n("label",{for:"note"},"Suggerimento",-1)),r($,{type:"text",modelValue:s.value.tooltip,"onUpdate:modelValue":t[3]||(t[3]=o=>s.value.tooltip=o),class:"p-column-filter"},null,8,["modelValue"])])]),n("div",me,[r(X,{label:"Salva",onClick:p})])]),_:1})]),n("div",fe,[r(U,{class:"h-full"},{content:V(()=>[n("div",ye,[t[9]||(t[9]=n("h1",null,"PREVIEW",-1)),n("h3",_e,C(s.value.title),1),n("h4",he,C(s.value.description),1),s.value.tooltip?(D(),Q("small",be,C(s.value.tooltip),1)):E("v-if",!0),(D(!0),Q(j,null,ae(s.value.answers,o=>(D(),Q("p",{key:o.id,class:"mb-0"},[ne(C(o.label)+" ",1),o.tooltip?oe((D(),Q("i",ge,null,512)),[[J,o.tooltip,void 0,{top:!0}]]):E("v-if",!0)]))),128))])]),_:1})])]),n("div",qe,[r(U,null,{content:V(()=>[t[10]||(t[10]=n("div",{class:"flex align-items-center justify-content-between"},[n("h1",null,"RISPOSTE")],-1)),n("div",Qe,[r(H,{value:s.value.answers,responsiveLayout:"scroll",editMode:"row",dataKey:"id",editingRows:b.value,"onUpdate:editingRows":t[4]||(t[4]=o=>b.value=o),onRowEditSave:W},{default:V(()=>[r(L,{field:"label",header:"Risposte"},{editor:V(({data:o,field:x})=>[r($,{modelValue:o[x],"onUpdate:modelValue":R=>o[x]=R,autofocus:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(L,{field:"tooltip",header:"Suggerimento"},{editor:V(({data:o,field:x})=>[r($,{modelValue:o[x],"onUpdate:modelValue":R=>o[x]=R,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(L,{rowEditor:!0,style:{width:"10%","min-width":"8rem"},bodyStyle:"text-align:center"})]),_:1},8,["value","editingRows"])])]),_:1})])])}}});const Be=ie(Ve,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/components/questions/QuestionDetailForm.vue"]]);export{Be as Q,xe as a,Ae as u};
