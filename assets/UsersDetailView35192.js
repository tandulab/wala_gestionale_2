import{g as te,l,k as se,h as oe,i as ne,j as le,c as ie,n as re,r as C,a as d,d as o,b as r,w as ue,I as ce,m,L as de,o as u,f as me,e as v,y as h,s as ve,q as w,C as b,Y as fe,B as T,_ as pe}from"../index35192.js";import{u as _e}from"./useComponyStore35192.js";import{u as ge,P as ye}from"./PaginatedAutoComplete35192.js";import{u as Ce}from"./useUserStore35192.js";import"./common-service35192.js";const be={class:"m-4"},he={class:"flex align-items-center justify-content-between"},we={class:"formgrid grid col-10"},Ue={class:"field col-6"},Ve={key:0,id:"name",class:"p-error"},ke={class:"field col-6"},xe={key:0,id:"name",class:"p-error"},De={class:"field col-6"},Ne={key:0,id:"name",class:"p-error"},Se={class:"field col-6"},Be={for:"company"},Ee={key:0},Re={key:0,id:"company",class:"p-error"},Te={class:"flex justify-content-end"},ze=te({__name:"UsersDetailView",setup(Ie){const z=l({icon:"pi pi-home",to:"/referenti"}),c=l(null),U=l([{label:""}]),I=se(),A=oe(),n=ne(),t=l({}),F=le(),f=l(!1),p=l(!1),_=l(!1),B=l(),{showLoader:V,hideLoader:i}=de(),L=_e(),g=Ce(),y=l(!1),M=ie(()=>g.currentUser),P=async function(a){try{return await L.fetchAllCompanies(a)}catch(e){i(),m(n,e)}},{data:E,fetchInit:j,fetchMore:q,isLoading:O}=ge(P,"companies"),Y=async function(a){try{const e=await g.fetchUserDetail(a);return J(),e}catch(e){i(),m(n,e)}},G=async function(){if(!(x()||k()||D()||N()||!t.value.id)){V();try{const a=await g.updateUser(t.value.id,t.value);return b(n,{message:"Referente aggiornato correttamente.",title:""}),T.replace({name:"referenti"}),i(),a}catch(a){i(),m(n,a)}}},H=async function(){if(!(x()||k()||D()||N())){V();try{const a=await g.createUser(t.value);return b(n,{message:"Referente creato correttamente.",title:""}),await T.replace({name:"referenti"}),a}catch(a){m(n,a)}finally{i()}}},J=function(){t.value={...M.value}},K=function(){if(B.value&&t.value.id){if(!t.value.company_id){b(n,{message:"Campo azienda obbligatorio",title:"",error:!0});return}Q()}else c.value!=""&&t.value.id?G():H()},Q=async function(){V();const a={user_id:t.value.id,user:{company_id:t.value.company_id}};try{const e=await A.dispatch(fe.ADD_USER_TO_ADMIN,a);return b(n,{message:"Referente creato correttamente.",title:""}),i(),e}catch(e){i(),m(n,e)}},k=function(){var a,e;return((a=t.value)==null?void 0:a.last_name)==""||((e=t.value)==null?void 0:e.last_name)==null?p.value=!0:p.value=!1,p.value},x=function(){var a,e;return((a=t.value)==null?void 0:a.first_name)==""||((e=t.value)==null?void 0:e.first_name)==null?f.value=!0:f.value=!1,f.value},D=function(){var a,e;return((a=t.value)==null?void 0:a.email)==""||((e=t.value)==null?void 0:e.email)==null?_.value=!0:_.value=!1,_.value},N=function(){var a;return(a=t.value)!=null&&a.company?y.value=!1:y.value=!0,y.value},W=a=>{F.require({target:a.currentTarget,message:"Sei sicuro di voler inviare le credenziali?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{X()}})},X=async function(){if(!!c.value)try{const a=await g.sendCredentials(c.value);return b(n,{message:"Credenziali inviate correttamente.",title:""}),a}catch(a){i(),m(n,a)}},Z=function(a){t.value.company=a,t.value.company_id=a.id,N()};return re(async()=>{c.value=I.params.id||null,c.value?(await Y(c.value),U.value[0]={label:"Modifica referente"}):U.value[0]={label:"Nuovo referente"}}),(a,e)=>{const $=C("Breadcrumb"),R=C("Button"),S=C("InputText"),ee=C("Card"),ae=C("ConfirmPopup");return u(),d(ce,null,[o("div",be,[r($,{home:z.value,model:U.value,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),r(ee,null,{content:ue(()=>[o("div",he,[e[7]||(e[7]=o("h1",null,"REFERENTE",-1)),t.value.id?(u(),me(R,{key:0,label:"Invia credenziali",onClick:e[0]||(e[0]=s=>W(s)),class:"p-button-outlined"})):v("v-if",!0)]),o("div",we,[o("div",Ue,[e[8]||(e[8]=o("label",{for:"name"},"Nome*",-1)),r(S,{id:"name",type:"text",modelValue:t.value.first_name,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.first_name=s),class:h(["w-full",{"p-invalid":f.value}]),onChange:x},null,8,["modelValue","class"]),f.value?(u(),d("small",Ve,"Campo obbligatorio.")):v("v-if",!0)]),o("div",ke,[e[9]||(e[9]=o("label",{for:"name"},"Cognome*",-1)),r(S,{id:"name",type:"text",modelValue:t.value.last_name,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.last_name=s),class:h(["w-full",{"p-invalid":p.value}]),onChange:k},null,8,["modelValue","class"]),p.value?(u(),d("small",xe,"Campo obbligatorio.")):v("v-if",!0)]),o("div",De,[e[10]||(e[10]=o("label",{for:"name"},"Email*",-1)),r(S,{id:"name",type:"text",modelValue:t.value.email,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.email=s),class:h(["w-full",{"p-invalid":_.value}]),onChange:D},null,8,["modelValue","class"]),_.value?(u(),d("small",Ne,"Campo obbligatorio.")):v("v-if",!0)]),o("div",Se,[o("label",Be,[e[11]||(e[11]=ve("Azienda",-1)),B.value!=""?(u(),d("span",Ee,"*")):v("v-if",!0)]),r(ye,{id:"company","model-value":t.value.company,suggestions:w(E),class:h({"p-invalid":y.value}),"onUpdate:suggestions":e[4]||(e[4]=s=>E.value=s),"onUpdate:modelValue":Z,onFirstFetch:e[5]||(e[5]=s=>w(j)(s)),onFetchMore:e[6]||(e[6]=s=>w(q)(s)),"is-loading":w(O)},null,8,["model-value","suggestions","class","is-loading"]),y.value?(u(),d("small",Re,"Campo obbligatorio.")):v("v-if",!0)])]),o("div",Te,[r(R,{label:"Salva",onClick:K})])]),_:1})]),r(ae)],64)}}});const je=pe(ze,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/views/users/UsersDetailView.vue"]]);export{je as default};
