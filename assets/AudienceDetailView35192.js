import{g as G,h as O,i as H,k as Y,l as u,r as v,o as p,a as w,b as i,w as _,s as k,e as C,a3 as pe,m as B,_ as Z,n as ve,f as K,d as o,y as R,q as M,I as fe,G as ye,t as $,C as N,B as _e}from"../index35192.js";import{h as T,s as S}from"./loader35192.js";import{u as ge}from"./useAudienceStore35192.js";import{u as we}from"./useComponyStore35192.js";import{u as Ce,P as be}from"./PaginatedAutoComplete35192.js";import"./common-service35192.js";const Ae={key:0},xe=G({__name:"ContactsTable",props:{contacts:{type:Array,required:!1}},setup(z){const F=O(),b=H(),D=Y(),E=u(),r=u({email:{value:"",matchMode:"contains"}}),c=u(!0),s=u();function f(){const n=new Map;n.set("email",r.value.email.value),n.set("page",s.value.page+1),n.set("per_page",s.value.rows),s.value.sortField&&(s.value.sortOrder==1?n.set("sorted_by",s.value.sortField+"_asc"):n.set("sorted_by",s.value.sortField+"_desc")),setTimeout(()=>{g()},Math.random()*1e3+250)}const g=async function(){try{const n=await F.dispatch(pe.FETCH_AUDIENCE_DETAIL,D.params.id+"");return c.value=!1,n}catch(n){T(F),B(b,n)}},A=n=>{s.value=n,f()},U=n=>{s.value=n,f()};return(n,a)=>{const y=v("Column"),V=v("DataTable");return z.contacts?(p(),w("div",Ae,[i(V,{value:z.contacts,lazy:!1,paginator:!0,rows:30,ref_key:"dt",ref:E,dataKey:"id",onPage:a[0]||(a[0]=x=>A(x)),onSort:a[1]||(a[1]=x=>U(x)),stateStorage:"local",stateKey:"dt-campaigns",removableSort:""},{empty:_(()=>[...a[2]||(a[2]=[k(" Nessun referente trovato. ",-1)])]),default:_(()=>[i(y,{field:"email",header:"Email",ref:"email"},null,512),i(y,{field:"first_name",header:"Nome",ref:"name"},null,512),i(y,{field:"last_name",header:"Cognome",ref:"surname"},null,512)]),_:1},8,["value"])])):C("v-if",!0)}}}),he=Z(xe,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/components/tables/ContactsTable.vue"]]),Be={class:"m-4"},De={class:"flex align-items-center justify-content-between"},ke={class:"flex align-items-center justify-content-between mx-0"},Te={class:"field col-4 px-0"},Fe={key:0,id:"name",class:"p-error"},Me={class:"field col-4 p-0 m-0 mb-3"},Se={key:0,id:"company",class:"p-error"},ze={class:"flex align-items-center justify-content-between"},Ee={key:0,class:"m-0 p-0 list-none"},Ue={class:"flex align-items-center"},Ve=["onClick"],Ne={class:"flex justify-content-end mt-3"},Ie=G({__name:"AudienceDetailView",setup(z){const F=u({icon:"pi pi-home",to:"/audience"}),b=u(!1),D=u([{label:""}]),E=Y(),r=O(),c=H(),s=u(new Array),f=u(!1),g=u(!1),A=ge(),U=we(),n=u(),a=u({}),y=u(),V=async function(t){try{return await U.fetchAllCompanies({page:t.page,limit:t.limit,name_like:t.query||void 0})}catch(e){B(c,e)}},{data:x,fetchInit:J,fetchMore:Q,isLoading:W}=Ce(V,"companies"),X=async function(t){await S(r);try{a.value=await A.fetchAudienceDetail(t),n.value=a.value.company}catch(e){B(c,e)}finally{await T(r)}},ee=()=>{b.value=!0},ae=()=>{b.value=!1},te=t=>{if(t===0)return"0 B";let e=1e3,m=3,d=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],h=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,h)).toFixed(m))+" "+d[h]},ne=t=>{s.value=t.files},oe=function(t){s.value.splice(t,1)},I=async function(){var t;if(!!((t=a.value)!=null&&t.id)){await S(r);try{a.value=await A.importContacts(a.value.id,s.value[0]),s.value=[],N(c,{message:"File caricato correttamente.",title:""}),ae()}catch(e){B(c,e)}finally{await T(r)}}},L=function(){var t;return(t=a.value)!=null&&t.name?f.value=!1:f.value=!0,f.value},P=function(){return n.value?g.value=!1:g.value=!0,g.value},se=function(){L()||P()||(y.value&&a.value?ie():le())},le=async function(){var e,m,d;await S(r);const t={name:(e=a==null?void 0:a.value)==null?void 0:e.name,company_id:(m=n.value)==null?void 0:m.id};try{a.value=await A.createAudience(t),(d=a.value)!=null&&d.id&&await _e.replace({name:"dettaglio-audience",params:{id:a.value.id}}),N(c,{message:"Audience creato correttamente.",title:""})}catch(h){B(c,h)}finally{await T(r)}},ie=async function(){var e,m;if(!((e=a==null?void 0:a.value)!=null&&e.id))return;await S(r);const t={name:a.value.name,company_id:(m=n==null?void 0:n.value)==null?void 0:m.id};try{await A.updateAudience(a.value.id,t),N(c,{message:"Audience aggiornato correttamente.",title:""})}catch(d){B(c,d)}finally{await T(r)}};function ue(t){n.value=t,P()}return ve(async()=>{y.value=E.params.id,y.value?(await X(y.value),D.value[0]={label:"Modifica audience"}):D.value[0]={label:"Nuova audience"}}),(t,e)=>{var q;const m=v("Breadcrumb"),d=v("Button"),h=v("InputText"),j=v("Card"),re=v("Message"),ce=v("FileUpload"),de=v("Dialog");return p(),w("div",Be,[i(m,{home:F.value,model:D.value,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),i(j,null,{content:_(()=>[o("div",De,[e[6]||(e[6]=o("h1",{class:"mb-3"},"AUDIENCE",-1)),i(d,{class:"",label:"Salva",onClick:se})]),o("div",ke,[C(" <h1>{{ audience_detail.name }}</h1> "),o("div",Te,[e[7]||(e[7]=o("label",{for:"name"},"Nome audience*",-1)),i(h,{id:"name",type:"text",modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.name=l),class:R(["w-full",{"p-invalid":f.value}]),onChange:L},null,8,["modelValue","class"]),f.value?(p(),w("small",Fe,"Campo obbligatorio.")):C("v-if",!0)])]),o("div",Me,[e[8]||(e[8]=o("label",{for:"company"},"Azienda*",-1)),i(be,{id:"company","model-value":n.value,suggestions:M(x),class:R({"p-invalid":g.value}),"onUpdate:suggestions":e[1]||(e[1]=l=>x.value=l),"onUpdate:modelValue":ue,onFirstFetch:e[2]||(e[2]=l=>M(J)(l)),onFetchMore:e[3]||(e[3]=l=>M(Q)(l)),"is-loading":M(W)},null,8,["model-value","suggestions","class","is-loading"]),g.value?(p(),w("small",Se,"Campo obbligatorio.")):C("v-if",!0)])]),_:1}),(q=a.value)!=null&&q.id?(p(),K(j,{key:0,class:"mt-4"},{content:_(()=>[o("div",ze,[e[14]||(e[14]=o("h1",null,"Contatti",-1)),o("div",null,[e[13]||(e[13]=o("a",{href:"https://wala.s3-eu-central-1.amazonaws.com/wala_template_import_audience.xlsx",class:"p-button mr-4 p-button-outlined",icon:"pi pi-download"},[o("i",{class:"pi pi-download mr-2"}),k(" TEMPLATE ")],-1)),i(d,{class:"",label:"carica",icon:"pi pi-upload",onClick:ee}),i(de,{header:"CARICA FILE",visible:b.value,"onUpdate:visible":e[5]||(e[5]=l=>b.value=l),style:{width:"500px"}},{default:_(()=>[a.value.audience_users&&a.value.audience_users.length>0?(p(),K(re,{key:0,severity:"warn"},{default:_(()=>[...e[9]||(e[9]=[k("Attenzione! Importando un nuovo file i contatti presenti verrano sovrascritti. ",-1)])]),_:1})):C("v-if",!0),i(ce,{name:"files[]",onUploader:I,multiple:!1,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:2e6,customUpload:!0,modelValue:s.value,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value=l),onSelect:ne},{content:_(()=>[s.value?(p(),w("ul",Ee,[(p(!0),w(fe,null,ye(s.value,(l,me)=>(p(),w("li",{key:l.name,class:"flex align-items-center p-fileupload-file justify-content-between"},[o("div",Ue,[e[10]||(e[10]=o("i",{class:"pi mr-2 document-icon"},null,-1)),k(" "+$(l.name),1),e[11]||(e[11]=o("br",null,null,-1)),k(" "+$(te(l.size)),1)]),o("i",{class:"pi pi-times p-button-icon text-red-600 cursor-pointer font-semibold",onClick:Le=>oe(me)},null,8,Ve)]))),128))])):C("v-if",!0)]),empty:_(()=>[...e[12]||(e[12]=[o("div",{class:"text-center"},[o("b",null,"Trascina qui il documento"),o("p",{class:"text-xs"},"(Dimensione massima 20 MB)")],-1)])]),_:1},8,["modelValue"]),o("div",Ne,[i(d,{class:"p-button-outlined",label:"carica",icon:"pi pi-upload",onClick:I})])]),_:1},8,["visible"])])]),i(he,{contacts:a.value.audience_users},null,8,["contacts"])]),_:1})):C("v-if",!0)])}}}),Ge=Z(Ie,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/views/audience/AudienceDetailView.vue"]]);export{Ge as default};
