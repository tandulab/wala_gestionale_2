import{g as k,h as G,i as H,k as C,c as w,l as T,m as Q,r,n as W,o as m,a as _,b as o,w as l,s as x,v as X,t as S,z as F,p as c,q as Y,A as Z,B as ee,_ as V,d as M}from"../index58703.js";import{T as te,u as oe}from"./useLazyData58703.js";import{u as D}from"./useUserStore58703.js";const se=k({__name:"UsersTable",setup(B){const i=G(),p=H(),v=C(),{showLoader:d,hideLoader:h}=Y(),n=D(),f=C({email:{value:"",matchMode:te.LIKE}}),{onSort:L,onPage:N,loadLazyData:y,isLoading:K,onFilter:R,tableRows:z}=oe({rows:30},$,localStorage.getItem("dt-users")?JSON.parse(localStorage.getItem("dt-users")):void 0),E=w(()=>n.currentUsers),I=w(()=>n.currentUsersTotal);async function $(s){s.role_eq="admin";try{d(),await n.fetchAllUsers(s)}catch(e){T(i,e)}finally{h()}}const q=async function(s){try{await n.deleteUser(s),ee(i,{message:"Referente eliminato correttamente.",title:""}),await y()}catch(e){T(i,e)}},A=(s,e)=>{!e||p.require({target:s.currentTarget,message:"Sei sicuro di voler eliminare questo referente?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{q(e)}})},O=function(s){Z.push({name:"dettaglio-referente",params:{id:s.id}})};return Q(()=>{y()}),(s,e)=>{const P=r("InputText"),u=r("Column"),b=r("Button"),j=r("DataTable"),J=r("ConfirmPopup"),g=W("tooltip");return m(),_("div",null,[o(j,{value:E.value,totalRecords:I.value,lazy:!0,paginator:!0,rows:c(z),filters:f.value,"onUpdate:filters":e[0]||(e[0]=t=>f.value=t),ref_key:"dt",ref:v,dataKey:"id",loading:c(K),onPage:e[1]||(e[1]=t=>c(N)(t)),onSort:e[2]||(e[2]=t=>c(L)(t)),onFilter:e[3]||(e[3]=()=>c(R)(f.value)),filterDisplay:"row",stateStorage:"local",stateKey:"dt-users",removableSort:""},{empty:l(()=>[...e[4]||(e[4]=[x(" Nessun referente trovato. ",-1)])]),default:l(()=>[o(u,{field:"email",header:"Email",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:l(({filterModel:t,filterCallback:a})=>[o(P,{type:"text",modelValue:t.value,"onUpdate:modelValue":U=>t.value=U,onKeydown:X(U=>a(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),o(u,{field:"first_name",header:"Nome",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1}),o(u,{field:"last_name",header:"Cognome",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1}),o(u,{field:"company",header:"Azienda",sortable:!1},{body:l(({data:t})=>{var a;return[x(S(((a=t.company)==null?void 0:a.name)||"-"),1)]}),_:1}),o(u,{header:"",style:{width:"9rem"}},{body:l(({data:t})=>[F(o(b,{type:"button",onClick:a=>O(t),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[g,"Modifica",void 0,{top:!0}]]),F(o(b,{type:"button",onClick:a=>A(a,t.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200",icon:"pi pi-trash"},null,8,["onClick"]),[[g,"Elimina",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","rows","filters","loading"]),o(J)])}}}),ae=V(se,[["__file","/opt/atlassian/pipelines/agent/build/src/components/tables/UsersTable.vue"]]),re={class:"flex justify-content-between align-items-center"},ne={class:"uppercase"},le={key:0},ie={key:1},ue=k({__name:"UsersView",setup(B){const i=D(),p=w(()=>i.currentUsersTotal);return(v,d)=>{const h=r("Button"),n=r("Card");return m(),_("div",null,[o(n,null,{content:l(()=>[M("div",re,[M("h1",ne,[p.value==1?(m(),_("span",le," 1 Referente")):(m(),_("span",ie,S(p.value)+" Referenti",1))]),o(h,{label:"Nuovo referente",onClick:d[0]||(d[0]=f=>v.$router.push("/dettaglio-referente"))})]),o(ae)]),_:1})])}}}),fe=V(ue,[["__file","/opt/atlassian/pipelines/agent/build/src/views/users/UsersView.vue"]]);export{fe as default};
