import{g as F,h as M,i as J,j as Y,l as S,c as g,m as T,n as Z,r as n,p as H,o as c,a as d,b as o,w as l,s as E,v as Q,t as R,z as x,q as u,L as W,B as X,Y as ee,C as te,_ as k,d as oe,e as ae,Z as se}from"../index35192.js";import{T as re,u as ne}from"./useLazyData35192.js";import{u as le}from"./useUserStore35192.js";const ie=F({__name:"UsersTable",setup(D){const f=M(),s=J(),_=Y(),p=S(),{showLoader:v,hideLoader:w}=W(),m=le(),h=S({email:{value:"",matchMode:re.LIKE}}),{onSort:V,onPage:N,loadLazyData:y,isLoading:z,onFilter:L,tableRows:B}=ne({rows:30},O,localStorage.getItem("dt-users")?JSON.parse(localStorage.getItem("dt-users")):void 0),I=g(()=>m.currentUsers),K=g(()=>m.currentUsersTotal);async function O(a){a.role_eq="admin";try{v(),await m.fetchAllUsers(a)}catch(e){T(s,e)}finally{w()}}const $=async function(a){try{await f.dispatch(ee.DELETE_USER,a),te(s,{message:"Referente eliminato correttamente.",title:""}),await y()}catch(e){T(s,e)}},q=(a,e)=>{!e||_.require({target:a.currentTarget,message:"Sei sicuro di voler eliminare questo referente?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{$(e)}})},A=function(a){X.push({name:"dettaglio-referente",params:{id:a.id}})};return Z(()=>{y()}),(a,e)=>{const P=n("InputText"),i=n("Column"),b=n("Button"),j=n("DataTable"),G=n("ConfirmPopup"),U=H("tooltip");return c(),d("div",null,[o(j,{value:I.value,totalRecords:K.value,lazy:!0,paginator:!0,rows:u(B),filters:h.value,"onUpdate:filters":e[0]||(e[0]=t=>h.value=t),ref_key:"dt",ref:p,dataKey:"id",loading:u(z),onPage:e[1]||(e[1]=t=>u(N)(t)),onSort:e[2]||(e[2]=t=>u(V)(t)),onFilter:e[3]||(e[3]=()=>u(L)(h.value)),filterDisplay:"row",stateStorage:"local",stateKey:"dt-users",removableSort:""},{empty:l(()=>[...e[4]||(e[4]=[E(" Nessun referente trovato. ",-1)])]),default:l(()=>[o(i,{field:"email",header:"Email",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:l(({filterModel:t,filterCallback:r})=>[o(P,{type:"text",modelValue:t.value,"onUpdate:modelValue":C=>t.value=C,onKeydown:Q(C=>r(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),o(i,{field:"first_name",header:"Nome",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1}),o(i,{field:"last_name",header:"Cognome",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1}),o(i,{field:"company",header:"Azienda",sortable:!1},{body:l(({data:t})=>{var r;return[E(R(((r=t.company)==null?void 0:r.name)||"-"),1)]}),_:1}),o(i,{header:"",style:{width:"9rem"}},{body:l(({data:t})=>[x(o(b,{type:"button",onClick:r=>A(t),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[U,"Modifica",void 0,{top:!0}]]),x(o(b,{type:"button",onClick:r=>q(r,t.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200",icon:"pi pi-trash"},null,8,["onClick"]),[[U,"Elimina",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","rows","filters","loading"]),o(G)])}}}),ue=k(ie,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/components/tables/UsersTable.vue"]]),ce={class:"flex justify-content-between align-items-center"},de={key:0,class:"uppercase"},pe={key:0},me={key:1},fe=F({__name:"UsersView",setup(D){const f=M(),s=g(()=>f.getters[se.CURRENT_USERS]);return(_,p)=>{const v=n("Button"),w=n("Card");return c(),d("div",null,[o(w,null,{content:l(()=>[oe("div",ce,[s.value?(c(),d("h1",de,[s.value.total==1?(c(),d("span",pe," 1 Referente")):(c(),d("span",me,R(s.value.total)+" Referenti",1))])):ae("v-if",!0),o(v,{label:"Nuovo referente",onClick:p[0]||(p[0]=m=>_.$router.push("/dettaglio-referente"))})]),o(ue)]),_:1})])}}}),he=k(fe,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/views/users/UsersView.vue"]]);export{he as default};
