import{g as J,h as z,i as Q,j as W,l as M,c as x,m as T,n as X,r as l,p as Z,a as u,b as o,w as i,q as n,o as d,s as Y,v as ee,t as E,x as h,I as te,G as oe,z as C,a6 as ae,a5 as D,B as re,C as N,_ as B,a9 as se,d as V,e as ne}from"../index35192.js";import{T as le,u as ie}from"./useLazyData35192.js";import{u as pe}from"./useReportStore35192.js";import{h as ce}from"./loader35192.js";const ue=J({__name:"ReportsTable",setup(m){const r=z(),p=Q(),f=W(),S=M(),_=pe(),c=M({title:{value:"",matchMode:le.LIKE}}),{onSort:b,onPage:w,loadLazyData:v,isLoading:F,onFilter:P,tableRows:O}=ie({rows:30},L,localStorage.getItem("new-dt-reports")?JSON.parse(localStorage.getItem("new-dt-reports")):void 0),$=x(()=>_.currentReports),I=x(()=>_.currentReportsTotal);async function L(a){try{await _.fetchAllReports(a)}catch(e){T(p,e)}finally{await ce(r)}}const K=async function(a){try{await r.dispatch(D.DELETE_REPORT,a),N(p,{message:"Report eliminato correttamente.",title:""}),await v()}catch(e){T(p,e)}},U=(a,e)=>{f.require({target:a.currentTarget,message:"Sei sicuro di voler eliminare questo report?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{K(e)}})},A=function(a){r.dispatch(D.SET_CREATED_AT,h.unix(a.created_at).format("YYYY-MM-DD")),re.push({name:"dettaglio-report",params:{id:a.id}})},q=async function(a){try{await r.dispatch(D.REFRESH_REPORT,a),N(p,{message:"Report aggiornato correttamente.",title:""}),await v()}catch(e){T(p,e)}};return X(()=>{v()}),(a,e)=>{const j=l("InputText"),R=l("Column"),g=l("Button"),G=l("DataTable"),H=l("ConfirmPopup"),y=Z("tooltip");return d(),u("div",null,[o(G,{value:$.value,totalRecords:I.value,lazy:!0,paginator:!0,rows:n(O),filters:c.value,"onUpdate:filters":e[0]||(e[0]=t=>c.value=t),ref_key:"dt",ref:S,dataKey:"id",loading:n(F),onPage:e[1]||(e[1]=t=>n(w)(t)),onSort:e[2]||(e[2]=t=>n(b)(t)),onFilter:e[3]||(e[3]=()=>n(P)(c.value)),filterDisplay:"row",stateStorage:"local",stateKey:"new-dt-reports",removableSort:""},{empty:i(()=>[...e[4]||(e[4]=[Y(" Nessun report trovato. ",-1)])]),default:i(()=>[o(R,{field:"title",header:"Nome",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:t,filterCallback:s})=>[o(j,{type:"text",modelValue:t.value,"onUpdate:modelValue":k=>t.value=k,onKeydown:ee(k=>s(),["enter"]),class:"p-column-filter",placeholder:"Filtra per report"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),o(R,{field:"created_at",header:"Data creazione",sortable:!1},{body:i(({data:t})=>[Y(E(n(h).unix(t.created_at).format("DD/MM/YYYY")),1)]),_:1}),o(R,{field:"campaign",header:"Campagne",sortable:!1},{body:i(({data:t})=>[(d(!0),u(te,null,oe(t.old_campaign_names,s=>(d(),u("p",{key:s,class:"m-0"},E(s),1))),128))]),_:1}),o(R,{header:"",style:{width:"14rem"}},{body:i(({data:t})=>[C(o(g,{type:"button",onClick:s=>A(t),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-chart-bar"},null,8,["onClick"]),[[y,"Report",void 0,{top:!0}]]),C(o(g,{type:"button",onClick:s=>q(t.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-refresh",disabled:n(ae)(n(h).unix(t.created_at).format("YYYY-MM-DD"))},null,8,["onClick","disabled"]),[[y,"Ricarica report",void 0,{top:!0}]]),C(o(g,{type:"button",onClick:s=>U(s,t.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200",icon:"pi pi-trash"},null,8,["onClick"]),[[y,"Elimina",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","rows","filters","loading"]),o(H)])}}}),de=B(ue,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/components/tables/ReportsTable.vue"]]),me={setup(){const m=z();return{reports:x(()=>m.getters[se.CURRENT_REPORTS])}},components:{ReportsTable:de}},fe={class:"flex justify-content-between align-items-center"},_e={key:0,class:"uppercase"};function ve(m,r,p,f,S,_){const c=l("Button"),b=l("ReportsTable"),w=l("Card");return d(),u("div",null,[o(w,null,{content:i(()=>[V("div",fe,[f.reports?(d(),u("h1",_e,[V("span",null,E(f.reports.total)+" Report",1)])):ne("v-if",!0),o(c,{class:"",label:"Nuovo report",onClick:r[0]||(r[0]=v=>m.$router.push("/nuovo-report"))})]),o(b)]),_:1})])}const ye=B(me,[["render",ve],["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/views/reports/ReportsView.vue"]]);export{ye as default};
