import{g as oe,h as ne,i as le,j as se,k as re,l as f,c as C,m as U,n as ie,r as i,p as ue,a as S,d as pe,e as c,b as n,w as l,q as u,o as p,s as v,f as g,v as z,t as k,x as E,y as ce,z as x,A as de,B as R,C as me,_ as fe}from"../index35192.js";import{T as D,u as ve}from"./useLazyData35192.js";import{u as ge}from"./useCampaignStore35192.js";import{h as ye}from"./loader35192.js";const be={key:0,class:"flex align-items-center justify-content-between mb-0 mr-0 col-12 generic-filters border-round-md mb-4 px-3"},he={key:0},_e=oe({__name:"CampaignsTable",setup(we,{expose:A}){const M=ne(),y=le(),B=se(),K=re(),N=f(),m=ge(),b=f({status:{value:"",matchMode:D.EQ},name:{value:"",matchMode:D.LIKE},company:{value:"",matchMode:D.LIKE}}),{onSort:I,onPage:Y,loadLazyData:T,isLoading:L,onFilter:P,tableRows:$}=ve({rows:30},G,localStorage.getItem("new-dt-campaigns")?JSON.parse(localStorage.getItem("new-dt-campaigns")):void 0),O=[{label:"Attiva",value:"active"},{label:"Conclusa",value:"finished"},{label:"Programmata",value:"scheduled"}],d=f(!1),h=f(),q=C(()=>m.currentCampaigns),j=C(()=>m.totalCampaigns),V=C(()=>M.getters[de.IS_USER_SUPERADMIN]);async function G(t){try{await m.fetchAllCampaigns(t)}catch(a){U(y,a)}finally{await ye(M)}}const H=async function(t){try{await m.deleteCampaign(t),me(y,{message:"Campagna eliminata correttamente.",title:""}),await T()}catch(a){U(y,a)}},J=(t,a)=>{B.require({target:t.currentTarget,message:"Sei sicuro di voler eliminare questa campagna?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{H(a)}})},Q=function(t){R.push({name:"dettaglio-campagna",params:{campaign_id:t.id}})},W=function(t){R.push({name:"report",params:{id:t}})},X=function(t){switch(t){case"active":return"Attiva";case"finished":return"Conclusa";case"scheduled":return"Programmata";default:return t}};return ie(()=>{T(),K.name=="nuovo-report"?d.value=!0:d.value=!1}),A({selectedCampaigns:h}),(t,a)=>{const r=i("Column"),F=i("InputText"),Z=i("Badge"),ee=i("Dropdown"),_=i("Button"),ae=i("DataTable"),te=i("ConfirmPopup"),w=ue("tooltip");return p(),S("div",null,[d.value?(p(),S("div",be,[...a[5]||(a[5]=[pe("div",null,"Seleziona le campagne che vuoi includere nel report",-1)])])):c("v-if",!0),n(ae,{value:q.value,totalRecords:j.value,lazy:!0,paginator:!0,rows:u($),filters:b.value,"onUpdate:filters":a[0]||(a[0]=e=>b.value=e),ref_key:"dt",ref:N,dataKey:"id",loading:u(L),onPage:a[1]||(a[1]=e=>u(Y)(e)),onSort:a[2]||(a[2]=e=>u(I)(e)),onFilter:a[3]||(a[3]=()=>u(P)(b.value)),filterDisplay:"row",stateStorage:"local",stateKey:"new-dt-campaigns",removableSort:"",selection:h.value,"onUpdate:selection":a[4]||(a[4]=e=>h.value=e)},{empty:l(()=>[...a[6]||(a[6]=[v(" Nessuna campagna trovata.",-1)])]),default:l(()=>[d.value?(p(),g(r,{key:0,selectionMode:"multiple",headerStyle:"width: 3em"})):c("v-if",!0),n(r,{field:"name",header:"Nome",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:l(({filterModel:e,filterCallback:o})=>[n(F,{type:"text",modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,onKeydown:z(s=>o(),["enter"]),class:"p-column-filter",placeholder:"Filtra per campagna"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),n(r,{field:"company",header:"Azienda",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:l(({data:e})=>{var o;return[v(k(((o=e.company)==null?void 0:o.name)||"-"),1)]}),filter:l(({filterModel:e,filterCallback:o})=>[n(F,{type:"text",modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,onKeydown:z(s=>o(),["enter"]),class:"p-column-filter",placeholder:"Filtra per azienda"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),n(r,{field:"start_at",header:"Data inizio",sortable:!1},{body:l(({data:e})=>[v(k(u(E)(e.start_at).format("DD/MM/YYYY")),1)]),_:1}),n(r,{field:"end_at",header:"Data fine",sortable:!1},{body:l(({data:e})=>[v(k(u(E)(e.end_at).format("DD/MM/YYYY")),1)]),_:1}),n(r,{field:"status",header:"Stato",sortable:!1,filterField:"status",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:l(({data:e})=>[e.status?(p(),S("span",he,[n(Z,{value:X(e.status),class:ce(["uppercase border-noround",e.status])},null,8,["value","class"])])):c("v-if",!0)]),filter:l(({filterModel:e,filterCallback:o})=>[n(ee,{options:O,id:"status",class:"p-column-filter",optionLabel:"label",optionValue:"value",placeholder:"Filtra per stato",modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,onChange:s=>o()},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),d.value?c("v-if",!0):(p(),g(r,{key:1,header:"",style:{width:"12rem"}},{body:l(({data:e})=>[x(n(_,{type:"button",onClick:o=>W(e.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-chart-bar",disabled:!e.report_ready},null,8,["onClick","disabled"]),[[w,"Report",void 0,{top:!0}]]),V.value?x((p(),g(_,{key:0,type:"button",onClick:o=>Q(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"])),[[w,"Modifica",void 0,{top:!0}]]):c("v-if",!0),V.value?x((p(),g(_,{key:1,type:"button",onClick:o=>J(o,e.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200",icon:"pi pi-trash",disabled:!e.can_delete},null,8,["onClick","disabled"])),[[w,"Elimina",void 0,{top:!0}]]):c("v-if",!0)]),_:1}))]),_:1},8,["value","totalRecords","rows","filters","loading","selection"]),n(te)])}}}),De=fe(_e,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/components/tables/CampaignsTable.vue"]]);export{De as C};
