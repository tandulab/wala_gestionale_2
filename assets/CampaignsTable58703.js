import{g as oe,h as ne,i as se,j as le,k as f,u as re,c as w,l as F,m as ie,r as i,n as ue,a as _,d as ce,e as p,b as n,w as s,p as u,q as pe,o as c,s as v,f as g,v as T,t as C,x as z,y as de,z as A,A as me,B as fe,_ as ve}from"../index58703.js";import{T as S,u as ge}from"./useLazyData58703.js";import{u as ye}from"./useCampaignStore58703.js";const he={key:0,class:"flex align-items-center justify-content-between mb-0 mr-0 col-12 generic-filters border-round-md mb-4 px-3"},be={key:0},we=oe({__name:"CampaignsTable",setup(_e,{expose:B}){const y=ne(),K=se(),L=le(),U=f(),m=ye(),{showLoader:N,hideLoader:Y}=pe(),h=f({status:{value:"",matchMode:S.EQ},name:{value:"",matchMode:S.LIKE},company:{value:"",matchMode:S.LIKE}}),{onSort:E,onPage:I,loadLazyData:M,isLoading:P,onFilter:R,tableRows:O}=ge({rows:30},Q,localStorage.getItem("new-dt-campaigns")?JSON.parse(localStorage.getItem("new-dt-campaigns")):void 0),$=[{label:"Attiva",value:"active"},{label:"Conclusa",value:"finished"},{label:"Programmata",value:"scheduled"}],d=f(!1),b=f(),q=re(),j=w(()=>m.currentCampaigns),J=w(()=>m.totalCampaigns),k=w(()=>q.isSuperAdmin);async function Q(t){try{N(),await m.fetchAllCampaigns(t)}catch(a){F(y,a)}finally{Y()}}const G=async function(t){try{await m.deleteCampaign(t),fe(y,{message:"Campagna eliminata correttamente.",title:""}),await M()}catch(a){F(y,a)}},H=(t,a)=>{K.require({target:t.currentTarget,message:"Sei sicuro di voler eliminare questa campagna?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{G(a)}})},W=function(t){me.push({name:"dettaglio-campagna",params:{campaign_id:t.id}})},X=function(t){switch(t){case"active":return"Attiva";case"finished":return"Conclusa";case"scheduled":return"Programmata";default:return t}};return ie(()=>{M(),L.name=="nuovo-report"?d.value=!0:d.value=!1}),B({selectedCampaigns:b}),(t,a)=>{const r=i("Column"),x=i("InputText"),Z=i("Badge"),ee=i("Dropdown"),D=i("Button"),ae=i("DataTable"),te=i("ConfirmPopup"),V=ue("tooltip");return c(),_("div",null,[d.value?(c(),_("div",he,[...a[5]||(a[5]=[ce("div",null,"Seleziona le campagne che vuoi includere nel report",-1)])])):p("v-if",!0),n(ae,{value:j.value,totalRecords:J.value,lazy:!0,paginator:!0,rows:u(O),filters:h.value,"onUpdate:filters":a[0]||(a[0]=e=>h.value=e),ref_key:"dt",ref:U,dataKey:"id",loading:u(P),onPage:a[1]||(a[1]=e=>u(I)(e)),onSort:a[2]||(a[2]=e=>u(E)(e)),onFilter:a[3]||(a[3]=()=>u(R)(h.value)),filterDisplay:"row",stateStorage:"local",stateKey:"new-dt-campaigns",removableSort:"",selection:b.value,"onUpdate:selection":a[4]||(a[4]=e=>b.value=e)},{empty:s(()=>[...a[6]||(a[6]=[v(" Nessuna campagna trovata.",-1)])]),default:s(()=>[d.value?(c(),g(r,{key:0,selectionMode:"multiple",headerStyle:"width: 3em"})):p("v-if",!0),n(r,{field:"name",header:"Nome",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:s(({filterModel:e,filterCallback:o})=>[n(x,{type:"text",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,onKeydown:T(l=>o(),["enter"]),class:"p-column-filter",placeholder:"Filtra per campagna"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),n(r,{field:"company",header:"Azienda",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:s(({data:e})=>{var o;return[v(C(((o=e.company)==null?void 0:o.name)||"-"),1)]}),filter:s(({filterModel:e,filterCallback:o})=>[n(x,{type:"text",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,onKeydown:T(l=>o(),["enter"]),class:"p-column-filter",placeholder:"Filtra per azienda"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),n(r,{field:"start_at",header:"Data inizio",sortable:!1},{body:s(({data:e})=>[v(C(u(z)(e.start_at).format("DD/MM/YYYY")),1)]),_:1}),n(r,{field:"end_at",header:"Data fine",sortable:!1},{body:s(({data:e})=>[v(C(u(z)(e.end_at).format("DD/MM/YYYY")),1)]),_:1}),n(r,{field:"status",header:"Stato",sortable:!1,filterField:"status",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:s(({data:e})=>[e.status?(c(),_("span",be,[n(Z,{value:X(e.status),class:de(["uppercase border-noround",e.status])},null,8,["value","class"])])):p("v-if",!0)]),filter:s(({filterModel:e,filterCallback:o})=>[n(ee,{options:$,id:"status",class:"p-column-filter",optionLabel:"label",optionValue:"value",placeholder:"Filtra per stato",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,onChange:l=>o()},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),d.value?p("v-if",!0):(c(),g(r,{key:1,header:"",style:{width:"12rem"}},{body:s(({data:e})=>[k.value?A((c(),g(D,{key:0,type:"button",onClick:o=>W(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"])),[[V,"Modifica",void 0,{top:!0}]]):p("v-if",!0),k.value?A((c(),g(D,{key:1,type:"button",onClick:o=>H(o,e.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200",icon:"pi pi-trash",disabled:!e.can_delete},null,8,["onClick","disabled"])),[[V,"Elimina",void 0,{top:!0}]]):p("v-if",!0)]),_:1}))]),_:1},8,["value","totalRecords","rows","filters","loading","selection"]),n(te)])}}}),ke=ve(we,[["__file","/opt/atlassian/pipelines/agent/build/src/components/tables/CampaignsTable.vue"]]);export{ke as C};
