import{g as M,h as H,i as Q,k as T,c as p,l as V,m as W,r as i,n as X,o as w,a as B,b as o,w as l,s as x,v as k,t as D,z as S,f as Y,e as Z,p as d,q as ee,A as te,B as oe,_ as K,d as y}from"../index58703.js";import{u as N}from"./useAudienceStore58703.js";import{T as F,u as ne}from"./useLazyData58703.js";import"./common-service58703.js";const ae=M({__name:"AudienceTable",setup(L){const r=H(),m=Q(),f=T(),s=N(),{hideLoader:v}=ee(),u=T({name:{value:"",matchMode:F.LIKE},"company.name":{value:"",matchMode:F.LIKE}}),{onSort:b,onPage:z,loadLazyData:g,isLoading:I,onFilter:$,tableRows:E}=ne({rows:30},q,localStorage.getItem("new-dt-audiences")?JSON.parse(localStorage.getItem("new-dt-audiences")):void 0),U=p(()=>s.currentAudiences),P=p(()=>s.currentAudiencesTotal);async function q(a){try{await s.fetchAllAudiences(a)}catch(t){V(r,t)}finally{v()}}const O=async function(a){try{await s.deleteAudience(a),oe(r,{message:"Audience eliminato correttamente.",title:""}),await g()}catch(t){V(r,t)}},R=(a,t)=>{!t||m.require({target:a.currentTarget,message:"Sei sicuro di voler eliminare questo audience?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{O(t)}})},j=function(a){te.push({name:"dettaglio-audience",params:{id:a.id}})};return W(()=>{g()}),(a,t)=>{const h=i("InputText"),_=i("Column"),A=i("Button"),J=i("DataTable"),G=i("ConfirmPopup"),C=X("tooltip");return w(),B("div",null,[o(J,{value:U.value,totalRecords:P.value,lazy:!0,paginator:!0,rows:d(E),filters:u.value,"onUpdate:filters":t[0]||(t[0]=e=>u.value=e),ref_key:"dt",ref:f,dataKey:"id",loading:d(I),onPage:t[1]||(t[1]=e=>d(z)(e)),onSort:t[2]||(t[2]=e=>d(b)(e)),onFilter:t[3]||(t[3]=()=>d($)(u.value)),filterDisplay:"row",stateStorage:"local",stateKey:"new-dt-audiences",removableSort:""},{empty:l(()=>[...t[4]||(t[4]=[x(" Nessun audience trovato.",-1)])]),default:l(()=>[o(_,{field:"name",header:"Nome",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:l(({filterModel:e,filterCallback:n})=>[o(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,onKeydown:k(c=>n(),["enter"]),class:"p-column-filter",placeholder:"Filtra per nome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),o(_,{field:"company.name",header:"Azienda",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:l(({data:e})=>{var n;return[x(D((n=e.company)==null?void 0:n.name),1)]}),filter:l(({filterModel:e,filterCallback:n})=>[o(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,onKeydown:k(c=>n(),["enter"]),class:"p-column-filter",placeholder:"Filtra per azienda"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),o(_,{header:"",style:{width:"9rem"}},{body:l(({data:e})=>[e.id?S((w(),Y(A,{key:0,type:"button",onClick:n=>j(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil",disabled:!e.can_edit},null,8,["onClick","disabled"])),[[C,"Modifica",void 0,{top:!0}]]):Z("v-if",!0),S(o(A,{type:"button",onClick:n=>R(n,e.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200",icon:"pi pi-trash",disabled:!e.can_delete},null,8,["onClick","disabled"]),[[C,"Elimina",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","rows","filters","loading"]),o(G)])}}}),se=K(ae,[["__file","/opt/atlassian/pipelines/agent/build/src/components/tables/AudienceTable.vue"]]),le={class:"flex justify-content-between align-items-center"},ie={class:"uppercase"},re=M({__name:"AudienceView",setup(L){const r=N(),m=p(()=>p(()=>r.currentAudiencesTotal));return(f,s)=>{const v=i("Button"),u=i("Card");return w(),B("div",null,[o(u,null,{content:l(()=>[y("div",le,[y("h1",ie,[y("span",null,D(m.value)+" Audience",1)]),o(v,{label:"Nuovo audience",onClick:s[0]||(s[0]=b=>f.$router.push("/dettaglio-audience"))})]),o(se)]),_:1})])}}}),me=K(re,[["__file","/opt/atlassian/pipelines/agent/build/src/views/audience/AudienceView.vue"]]);export{me as default};
