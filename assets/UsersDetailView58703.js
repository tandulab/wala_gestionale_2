import{g as ee,k as o,j as ae,h as te,i as se,c as ne,m as oe,r as y,a as m,d as n,b as i,w as le,G as ie,l as C,q as re,o as r,f as ue,e as d,y as b,s as ce,p as h,B as N,A as S,_ as me}from"../index58703.js";import{u as de}from"./useComponyStore58703.js";import{u as ve,P as fe}from"./PaginatedAutoComplete58703.js";import{u as pe}from"./useUserStore58703.js";import"./common-service58703.js";const _e={class:"m-4"},ge={class:"flex align-items-center justify-content-between"},ye={class:"formgrid grid col-10"},Ce={class:"field col-6"},be={key:0,id:"name",class:"p-error"},he={class:"field col-6"},we={key:0,id:"name",class:"p-error"},Ve={class:"field col-6"},Ue={key:0,id:"name",class:"p-error"},ke={class:"field col-6"},xe={for:"company"},Be={key:0},Ne={key:0,id:"company",class:"p-error"},De={class:"flex justify-content-end"},Ee=ee({__name:"UsersDetailView",setup(Fe){const T=o({icon:"pi pi-home",to:"/referenti"}),u=o(null),w=o([{label:""}]),L=ae(),l=te(),t=o({}),z=se(),v=o(!1),f=o(!1),p=o(!1),A=o(),{showLoader:D,hideLoader:c}=re(),I=de(),_=pe(),g=o(!1),M=ne(()=>_.currentUser),P=async function(a){try{return await I.fetchAllCompanies(a)}catch(e){c(),C(l,e)}},{data:E,fetchInit:R,fetchMore:j,isLoading:q}=ve(P,"companies"),G=async function(a){try{const e=await _.fetchUserDetail(a);return K(),e}catch(e){c(),C(l,e)}},H=async function(){if(!(U()||V()||k()||x()||!t.value.id)){D();try{const a=await _.updateUser(t.value.id,t.value);return N(l,{message:"Referente aggiornato correttamente.",title:""}),S.replace({name:"referenti"}),c(),a}catch(a){c(),C(l,a)}}},J=async function(){if(!(U()||V()||k()||x())){D();try{const a=await _.createUser(t.value);return N(l,{message:"Referente creato correttamente.",title:""}),await S.replace({name:"referenti"}),a}catch(a){C(l,a)}finally{c()}}},K=function(){t.value={...M.value}},O=function(){u.value!=""&&t.value.id?H():J()},V=function(){var a,e;return((a=t.value)==null?void 0:a.last_name)==""||((e=t.value)==null?void 0:e.last_name)==null?f.value=!0:f.value=!1,f.value},U=function(){var a,e;return((a=t.value)==null?void 0:a.first_name)==""||((e=t.value)==null?void 0:e.first_name)==null?v.value=!0:v.value=!1,v.value},k=function(){var a,e;return((a=t.value)==null?void 0:a.email)==""||((e=t.value)==null?void 0:e.email)==null?p.value=!0:p.value=!1,p.value},x=function(){var a;return(a=t.value)!=null&&a.company?g.value=!1:g.value=!0,g.value},Q=a=>{z.require({target:a.currentTarget,message:"Sei sicuro di voler inviare le credenziali?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{W()}})},W=async function(){if(!!u.value)try{const a=await _.sendCredentials(u.value);return N(l,{message:"Credenziali inviate correttamente.",title:""}),a}catch(a){c(),C(l,a)}},X=function(a){t.value.company=a,t.value.company_id=a.id,x()};return oe(async()=>{u.value=L.params.id||null,u.value?(await G(u.value),w.value[0]={label:"Modifica referente"}):w.value[0]={label:"Nuovo referente"}}),(a,e)=>{const Y=y("Breadcrumb"),F=y("Button"),B=y("InputText"),Z=y("Card"),$=y("ConfirmPopup");return r(),m(ie,null,[n("div",_e,[i(Y,{home:T.value,model:w.value,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),i(Z,null,{content:le(()=>[n("div",ge,[e[7]||(e[7]=n("h1",null,"REFERENTE",-1)),t.value.id?(r(),ue(F,{key:0,label:"Invia credenziali",onClick:e[0]||(e[0]=s=>Q(s)),class:"p-button-outlined"})):d("v-if",!0)]),n("div",ye,[n("div",Ce,[e[8]||(e[8]=n("label",{for:"name"},"Nome*",-1)),i(B,{id:"name",type:"text",modelValue:t.value.first_name,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.first_name=s),class:b(["w-full",{"p-invalid":v.value}]),onChange:U},null,8,["modelValue","class"]),v.value?(r(),m("small",be,"Campo obbligatorio.")):d("v-if",!0)]),n("div",he,[e[9]||(e[9]=n("label",{for:"name"},"Cognome*",-1)),i(B,{id:"name",type:"text",modelValue:t.value.last_name,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.last_name=s),class:b(["w-full",{"p-invalid":f.value}]),onChange:V},null,8,["modelValue","class"]),f.value?(r(),m("small",we,"Campo obbligatorio.")):d("v-if",!0)]),n("div",Ve,[e[10]||(e[10]=n("label",{for:"name"},"Email*",-1)),i(B,{id:"name",type:"text",modelValue:t.value.email,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.email=s),class:b(["w-full",{"p-invalid":p.value}]),onChange:k},null,8,["modelValue","class"]),p.value?(r(),m("small",Ue,"Campo obbligatorio.")):d("v-if",!0)]),n("div",ke,[n("label",xe,[e[11]||(e[11]=ce("Azienda",-1)),A.value!=""?(r(),m("span",Be,"*")):d("v-if",!0)]),i(fe,{id:"company","model-value":t.value.company,suggestions:h(E),class:b({"p-invalid":g.value}),"onUpdate:suggestions":e[4]||(e[4]=s=>E.value=s),"onUpdate:modelValue":X,onFirstFetch:e[5]||(e[5]=s=>h(R)(s)),onFetchMore:e[6]||(e[6]=s=>h(j)(s)),"is-loading":h(q)},null,8,["model-value","suggestions","class","is-loading"]),g.value?(r(),m("small",Ne,"Campo obbligatorio.")):d("v-if",!0)])]),n("div",De,[i(F,{label:"Salva",onClick:O})])]),_:1})]),i($)],64)}}});const Ie=me(Ee,[["__file","/opt/atlassian/pipelines/agent/build/src/views/users/UsersDetailView.vue"]]);export{Ie as default};
