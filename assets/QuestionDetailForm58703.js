import{C as R,D as le,k as V,c as S,E as z,g as se,h as ae,N as $,m as ie,r as f,n as ue,a as w,b as a,d as n,w as h,e as x,l as N,q as re,o as _,G as L,y as j,t as q,F as M,s as P,z as de,B as G,_ as ce}from"../index58703.js";import{u as ve}from"./useCampaignStore58703.js";class O{static async fetchAnswerDetail(s){return(await R.get(`/answers/${s}`)).answer}static async updateAnswer(s,m){return(await R.patch(`/answers/${s}`,m)).answer}static async updateBaseAnswer(s,m){return(await R.patch(`/base_answers/${s}`,m)).answer}}const ze=le("answer-store",()=>{const p=V(null),s=V(null),m=S(()=>p.value),o=S(()=>s.value);async function I(y){try{p.value=await O.fetchAnswerDetail(y)}catch(u){console.error(u)}}async function A(y,u){try{return p.value=await O.updateAnswer(y,u),p.value}catch(v){console.error(v)}}async function Q(y,u){try{return s.value=await O.updateBaseAnswer(y,u),s.value}catch(v){console.error(v)}}function D(){p.value=null}return{answer:z(p),baseAnswer:z(s),currentAnswer:m,currentBaseAnswer:o,fetchAnswerDetail:I,updateAnswer:A,updateBaseAnswer:Q,$reset:D}}),pe={class:"m-4"},me={class:"flex flex-wrap"},fe={class:"col-6 flex-1"},we={class:"flex align-items-center justify-content-between mt-2 mb-4"},_e={class:"formgrid grid col-12 flex flex-column"},ge={class:"field"},ye={class:"field flex flex-column"},be={class:"field flex flex-column"},he={class:"flex justify-content-end"},xe={class:"col-6 flex-1"},Ve={class:"flex flex-column preview"},Ae={class:"mb-0"},De={class:"mt-2"},qe={key:0},Ce={key:0,class:"pi pi-info-circle"},Se={class:"col-12"},Ie={class:"formgrid grid col-12 flex flex-column"},Qe={key:0,class:"col-12"},Be={class:"formgrid grid col-12"},ke={class:"field col-12 md:col-6"},Fe={key:0,class:"formgrid grid col-12"},Te={class:"field col-12"},Ue={class:"flex flex-column gap-2 mt-2"},Ee=["for"],Re={key:1,class:"mt-3 p-3 border-round",style:{"background-color":"#fee2e2",border:"1px solid #fca5a5"}},Ne={style:{color:"#991b1b"}},Le=se({__name:"QuestionDetailForm",props:{questionId:{type:String,required:!0},campaignId:{type:[String,null],required:!1},home:{type:Object,required:!0},items:{type:Array,required:!0},fetchQuestion:{type:Function,required:!0},updateQuestionFn:{type:Function,required:!0},updateAnswerFn:{type:Function,required:!0},getQuestionDetail:{type:Function,required:!0}},setup(p){const s=p,m=ae(),o=V({}),I=V([]),A=V(!1),{showLoader:Q,hideLoader:D}=re(),y=ve(),u=V(null),v=V([]),W=S(()=>{var c,g;const t=y.currentCampaign;if(!((g=(c=t==null?void 0:t.surveys)==null?void 0:c.win)!=null&&g.questions))return[];const e=t.surveys.win.questions,d=[],i=e.find(C=>C.order===1),r=e.find(C=>C.order===2);return i&&d.push({label:`Domanda 1: ${i.description||i.title||"Domanda WIN 1"}`,value:1,answers:i.answers||[]}),r&&d.push({label:`Domanda 2: ${r.description||r.title||"Domanda WIN 2"}`,value:2,answers:r.answers||[]}),d}),k=S(()=>u.value?W.value.find(t=>t.value===u.value):null),F=S(()=>{var i,r,c,g;const t=o.value;if(!t||!t.id)return!1;const e=(r=(i=t.code)==null?void 0:i.startsWith("impact_q"))!=null?r:!1,d=(g=(c=y.currentCampaign)==null?void 0:c.survey_codes)==null?void 0:g.includes("win");return e&&d});$(()=>o.value.answer_constraint,t=>{t?(u.value=t.question_order,v.value=[...t.answer_values]):(u.value=null,v.value=[])},{immediate:!0}),$(u,(t,e)=>{e!==null&&t!==e&&(v.value=[])});const H=()=>{if(!!F.value)return!u.value||v.value.length===0?null:{survey_code:"win",question_order:u.value,answer_values:v.value}},K=async function(){var e,d,i,r;if(T()||!s.questionId)return;Q();const t={description:(e=o.value.description)!=null?e:void 0,title:(d=o.value.title)!=null?d:void 0,tooltip:(i=o.value.tooltip)!=null?i:void 0,enabled:(r=o.value.enabled)!=null?r:void 0};F.value&&(t.answer_constraint=H());try{const c=await s.updateQuestionFn(s.questionId,t);return G(m,{message:"Domanda aggiornata correttamente.",title:""}),D(),c}catch(c){D(),N(m,c)}},J=function(){const t=s.getQuestionDetail();t&&(o.value={...t})},T=function(){var t,e;return((t=o.value)==null?void 0:t.description)==""||((e=o.value)==null?void 0:e.description)==null?A.value=!0:A.value=!1,A.value},X=async function(t){var d;if(T())return;Q();const e={label:t.label,tooltip:t.tooltip};try{const i=await s.updateAnswerFn(t.id,e);return i?(G(m,{message:"Risposta aggiornata correttamente.",title:""}),(d=o.value.answers)==null||d.forEach((r,c)=>{r.id==t.id&&o.value.answers&&(o.value.answers[c]=i)}),i):void 0}catch(i){N(m,i)}finally{D()}},Y=t=>{let{newData:e}=t;X(e)},Z=async function(t){try{return await s.fetchQuestion(t)}catch(e){D(),N(m,e)}};return ie(async()=>{s.questionId&&(await Z(s.questionId),J()),s.campaignId&&await y.fetchCampaignDetail(s.campaignId)}),(t,e)=>{const d=f("Breadcrumb"),i=f("Badge"),r=f("InputSwitch"),c=f("Textarea"),g=f("InputText"),C=f("Button"),B=f("Card"),U=f("Column"),ee=f("DataTable"),te=f("Dropdown"),ne=f("Checkbox"),oe=ue("tooltip");return _(),w("div",pe,[a(d,{home:p.home,model:p.items,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),n("div",me,[n("div",fe,[a(B,{class:"h-full"},{content:h(()=>[n("div",we,[e[7]||(e[7]=n("h1",{class:"m-0 p-0"},"DOMANDA",-1)),o.value.survey_code==="impact"?(_(),w(L,{key:0},[a(i,{value:o.value.enabled?"Attiva":"Disattivata",class:j(["uppercase border-noround ml-auto mr-2",o.value.enabled?"active":"finished"])},null,8,["value","class"]),a(r,{modelValue:o.value.enabled,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.enabled=l)},null,8,["modelValue"])],64)):x("v-if",!0)]),n("div",_e,[n("div",ge,[e[8]||(e[8]=n("label",{for:"note"},"Domanda",-1)),a(c,{id:"note",modelValue:o.value.description,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.description=l),rows:"5",cols:"30",class:j(["w-full",{"p-invalid":A.value}]),onChange:T},null,8,["modelValue","class"])]),n("div",ye,[e[9]||(e[9]=n("label",{for:"note"},"Titolo",-1)),a(g,{type:"text",modelValue:o.value.title,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.title=l),class:"p-column-filter"},null,8,["modelValue"])]),n("div",be,[e[10]||(e[10]=n("label",{for:"note"},"Suggerimento",-1)),a(g,{type:"text",modelValue:o.value.tooltip,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.tooltip=l),class:"p-column-filter"},null,8,["modelValue"])])]),n("div",he,[a(C,{label:"Salva",onClick:K})])]),_:1})]),n("div",xe,[a(B,{class:"h-full"},{content:h(()=>[n("div",Ve,[e[11]||(e[11]=n("h1",null,"PREVIEW",-1)),n("h3",Ae,q(o.value.title),1),n("h4",De,q(o.value.description),1),o.value.tooltip?(_(),w("small",qe,q(o.value.tooltip),1)):x("v-if",!0),(_(!0),w(L,null,M(o.value.answers,l=>(_(),w("p",{key:l.id,class:"mb-0"},[P(q(l.label)+" ",1),l.tooltip?de((_(),w("i",Ce,null,512)),[[oe,l.tooltip,void 0,{top:!0}]]):x("v-if",!0)]))),128))])]),_:1})])]),n("div",Se,[a(B,null,{content:h(()=>[e[12]||(e[12]=n("div",{class:"flex align-items-center justify-content-between"},[n("h1",null,"RISPOSTE")],-1)),n("div",Ie,[a(ee,{value:o.value.answers,responsiveLayout:"scroll",editMode:"row",dataKey:"id",editingRows:I.value,"onUpdate:editingRows":e[4]||(e[4]=l=>I.value=l),onRowEditSave:Y},{default:h(()=>[a(U,{field:"label",header:"Risposte"},{editor:h(({data:l,field:b})=>[a(g,{modelValue:l[b],"onUpdate:modelValue":E=>l[b]=E,autofocus:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(U,{field:"tooltip",header:"Suggerimento"},{editor:h(({data:l,field:b})=>[a(g,{modelValue:l[b],"onUpdate:modelValue":E=>l[b]=E,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(U,{rowEditor:!0,style:{width:"10%","min-width":"8rem"},bodyStyle:"text-align:center"})]),_:1},8,["value","editingRows"])])]),_:1})]),x(" Answer Constraint Section "),F.value?(_(),w("div",Qe,[a(B,null,{content:h(()=>[e[16]||(e[16]=n("div",{class:"flex align-items-center justify-content-between mb-4"},[n("h1",{class:"m-0"},"VINCOLO RISPOSTE (Area Bisogni)")],-1)),n("div",Be,[n("div",ke,[e[13]||(e[13]=n("label",{for:"win-question"},"Seleziona domanda Area Bisogni",-1)),a(te,{id:"win-question",modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value=l),options:W.value,optionLabel:"label",optionValue:"value",placeholder:"Seleziona una domanda",class:"w-full",showClear:""},null,8,["modelValue","options"])])]),k.value&&k.value.answers.length>0?(_(),w("div",Fe,[n("div",Te,[e[14]||(e[14]=n("label",null,"Seleziona le risposte vincolanti",-1)),n("div",Ue,[(_(!0),w(L,null,M(k.value.answers,l=>(_(),w("div",{key:l.value,class:"flex align-items-center"},[a(ne,{inputId:"answer-"+l.value,value:l.value,modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=b=>v.value=b)},null,8,["inputId","value","modelValue"]),n("label",{for:"answer-"+l.value,class:"ml-2"},q(l.label),9,Ee)]))),128))])])])):x("v-if",!0),u.value&&v.value.length>0?(_(),w("div",Re,[n("small",Ne,[e[15]||(e[15]=n("strong",null,"Vincolo attivo:",-1)),P(" Questa domanda verr\xE0 mostrata solo ai partecipanti che hanno risposto con una delle risposte selezionate alla domanda "+q(u.value)+" dell'Area Bisogni. ",1)])])):x("v-if",!0)]),_:1})])):x("v-if",!0)])}}});const $e=ce(Le,[["__file","/opt/atlassian/pipelines/agent/build/src/components/questions/QuestionDetailForm.vue"]]);export{$e as Q,ze as u};
