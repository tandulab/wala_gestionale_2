import{g as ae,k as _e,r as i,p as Oe,o as u,f as $,w as A,a as _,G as Je,d as l,t as ee,e as c,y as M,z as Ke,b as o,I as fe,B as j,_ as te,h as We,j as ge,i as ye,l as p,n as be,c as z,J as Ze,C as N,s as F,K as He,m as U,L as Ce,q as g,M as X,N as Xe,x as P}from"../index35192.js";import{u as xe}from"./useCampaignStore35192.js";import{u as ea}from"./useComponyStore35192.js";import{u as aa}from"./useAudienceStore35192.js";import{u as ve,P as pe}from"./PaginatedAutoComplete35192.js";import"./common-service35192.js";const ta={class:"flex flex-column w-full"},la={class:"flex justify-content-between py-2 px-3 align-items-center"},na={key:0,class:"text-500 font-semibold"},oa={class:"flex flex-row align-items-center gap-2"},sa={class:"px-3 py-2"},ia=ae({__name:"QuestionsList",props:{questions:{type:Array,required:!1},survey_code:{type:String,required:!0}},setup(E){const V=_e(),f=function(I,C){I.stopPropagation(),V.name=="dettaglio-campagna"?j.push({name:"campagna-dettaglio-domanda",params:{...V.params,question_id:C.id}}):j.push({name:"dettaglio-domanda",params:{id:C.id}})};return(I,C)=>{const d=i("Badge"),a=i("Button"),T=i("Column"),m=i("DataTable"),k=i("AccordionTab"),h=i("Accordion"),D=Oe("tooltip");return u(),$(h,null,{default:A(()=>[(u(!0),_(fe,null,Je(E.questions,(v,x)=>(u(),$(k,{key:v.id},{header:A(()=>[l("div",ta,[l("div",la,[v.description?(u(),_("div",na,ee(x+1)+") "+ee(v.description),1)):c("v-if",!0),l("div",oa,[E.survey_code==="impact"?(u(),$(d,{key:0,value:v.enabled?"Attiva":"Disattivata",class:M(["uppercase border-noround",v.enabled?"active":"finished"])},null,8,["value","class"])):c("v-if",!0),Ke(o(a,{type:"button",onClick:q=>f(q,v),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[D,"Modifica",void 0,{top:!0}]])])])])]),default:A(()=>[l("div",sa,[o(m,{value:v.answers,responsiveLayout:"scroll"},{default:A(()=>[o(T,{field:"label",header:"Risposte"}),c(`          <Column
            field="labels.label_it"
            header="Risposte"
            v-if="tab.labels"
          ></Column>`)]),_:1},8,["value"])])]),_:2},1024))),128))]),_:1})}}});const ua=te(ia,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/components/questions/QuestionsList.vue"]]),da={class:"px-3 mb-6 pb-6 flex align-items-center justify-content-between"},ra={key:0},ca={key:1},ma={key:2},va={class:"w-full"},pa={class:"field col-8"},_a={class:"flex align-items-center justify-content-end col-12 mt-5"},fa=ae({__name:"GeneratesUsersTab",props:{campaign_detail:{type:null,required:!0}},setup(E){const V=E,f=We(),I=ge(),C=ye(),d=p(!1),a=p(),T=p(!1),m=p(),k=xe(),{showLoader:h,hideLoader:D}=Ce();be(()=>{m.value=V.campaign_detail?V.campaign_detail.users_count:0});const v=z(()=>f.getters[He.USER_COUNTER]),x=()=>{d.value=!0,I.require({group:"generate-users",header:"Genera utenze",message:"",icon:"",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times"})},q=async function(){try{await k.generateSurveySubmissionLinks(V.campaign_detail.id,{counter:+a.value}),d.value=!1,a.value="",T.value=!1}catch(r){U(C,r),T.value=!1}},Q=function(){d.value=!1,a.value=""},O=function(){T.value=!0,q()},w=async function(){h();try{const r=await k.downloadExcelSubmissionLinks(V.campaign_detail.id),s=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),y=document.createElement("a");y.href=window.URL.createObjectURL(s),y.download=`campagna_${V.campaign_detail.name.replace(/\s/g,"_").toLocaleLowerCase()}.xlsx`,y.click(),D()}catch(r){U(C,r)}finally{D()}};return Ze(v,r=>{let s=r.counter+" utenze create con successo";r.counter==1&&(s="Un utenza creata con successo"),N(C,{message:s,title:""}),m.value=r.users_count}),(r,s)=>{const y=i("Button"),B=i("InputText"),R=i("ConfirmDialog");return u(),_(fe,null,[l("div",da,[l("div",null,[m.value==0?(u(),_("p",ra,"Non \xE8 stata generata nessuna utenza.")):c("v-if",!0),m.value==1?(u(),_("p",ca,[...s[5]||(s[5]=[F("E' stata generata ",-1),l("b",null,"1",-1),F(" utenza",-1)])])):c("v-if",!0),m.value>1?(u(),_("p",ma,[s[6]||(s[6]=F(" Sono state generate ",-1)),l("b",null,ee(m.value),1),s[7]||(s[7]=F(" utenze ",-1))])):c("v-if",!0)]),l("div",null,[o(y,{label:"Genera utenze",class:"p-button-outlined ml-3",onClick:s[0]||(s[0]=S=>x())}),o(y,{label:"Scarica Excel",class:"p-button-outlined ml-3",disabled:m.value==0,onClick:s[1]||(s[1]=S=>w())},null,8,["disabled"])])]),o(R,{group:"generate-users",visible:d.value,class:"generate-users"},{message:A(()=>[l("div",va,[l("div",pa,[s[8]||(s[8]=l("label",{for:"counter"},"Quante utenze vuoi generare?",-1)),o(B,{id:"counter",type:"number",modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=S=>a.value=S),class:"w-full",min:"1"},null,8,["modelValue"])]),l("div",_a,[o(y,{label:"Annulla",class:"mr-3 p-button-text",onClick:s[3]||(s[3]=S=>Q())}),o(y,{label:"Conferma",class:"",onClick:s[4]||(s[4]=S=>O()),disabled:!a.value||a.value<1||T.value},null,8,["disabled"])])])]),_:1},8,["visible"])],64)}}});const ga=te(fa,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/components/campaigns/GeneratesUsersTab.vue"]]),ya={class:"m-4"},ba={class:"flex align-items-center justify-content-between"},Ca={key:0},xa={class:"formgrid grid col-10"},wa={class:"field col-6"},Va={key:0,id:"name",class:"p-error"},ka={class:"field col-6"},Da={key:0,id:"company",class:"p-error"},Aa={class:"field col-6"},ha={key:0,id:"company",class:"p-error"},Sa={class:"flex align-items-center col-3 pl-3"},Ua={class:"my-0 col-12 flex flex-wrap mx-0"},Ia={class:"field col-6 flex flex-column pl-0"},Ta={key:0,id:"end_at",class:"p-error"},La={class:"field col-6 flex flex-column pr-0"},za={key:0,id:"end_at",class:"p-error"},qa={class:"my-0 col-12 flex flex-wrap mx-0"},Ma={class:"field col-6 pl-0"},$a={class:"field col-6 pl-0"},Ea={class:"field col-6 pl-0"},Ba={class:"flex flex-column col-3 pl-3 pt-5 gap-2"},Ra={key:0,id:"survey_code",class:"p-error"},Ya={class:"formgrid grid col-10"},Na={class:"field col-3 pl-0"},Ga={class:"flex justify-content-end"},Fa=ae({__name:"CampaignsDetailView",setup(E){const V=p({icon:"pi pi-home",to:"/campagne"}),f=p(null),I=p([{label:""}]),C=_e(),d=ye(),a=p({}),T="6d503a06-958b-4f83-af8d-92e39ced2f74",m=p(!1),k=p(!1),h=p(!1),D=p(!1),v=p(!1),x=p(!1),q=ge(),Q=ea(),O=aa(),w=xe(),{hideLoader:r,showLoader:s}=Ce(),y=t=>z({get:()=>{var e,b;return(b=(e=a.value.survey_codes)==null?void 0:e.includes(t))!=null?b:!1},set:e=>{a.value.survey_codes||(a.value.survey_codes=[]),e?a.value.survey_codes.includes(t)||a.value.survey_codes.push(t):a.value.survey_codes=a.value.survey_codes.filter(b=>b!==t),ce()}}),B=y("win"),R=y("climate"),S=y("impact"),J=z(()=>w.currentCampaign),Y=z(()=>w.currentSurveyCode),we=z(()=>{var t,e,b;return Y.value?(b=(e=(t=a.value.surveys)==null?void 0:t[Y.value])==null?void 0:e.questions)!=null?b:[]:[]}),le=z({get:()=>a.value.start_at?a.value.start_at instanceof Date?a.value.start_at:P(a.value.start_at,"YYYY-MM-DD").toDate():null,set:t=>{a.value.start_at=t?P(t).format("YYYY-MM-DD"):""}}),ne=z({get:()=>a.value.end_at?a.value.end_at instanceof Date?a.value.end_at:P(a.value.end_at,"YYYY-MM-DD").toDate():null,set:t=>{a.value.end_at=t?P(t).format("YYYY-MM-DD"):""}}),Ve=async function(t){try{return await Q.fetchAllCompanies({page:t.page,limit:t.limit,name_like:t.query||void 0})}catch(e){U(d,e)}},{data:oe,fetchInit:ke,fetchMore:De,isLoading:Ae}=ve(Ve,"companies"),he=async function(t){try{return await O.fetchAllAudiences({page:t.page,limit:t.limit,name_like:t.query||void 0})}catch(e){r(),U(d,e)}},{data:se,fetchInit:Se,fetchMore:Ue,isLoading:Ie}=ve(he,"audiences"),ie=async function(){try{s();const t=await w.fetchCampaignDetail(C.params.campaign_id);return ze(),t}catch(t){U(d,t)}finally{r()}},Te=async function(){var t,e,b;if(s(),!!f.value)try{const L={survey_codes:a.value.survey_codes,audience_id:a.value.audience_id,company_id:a.value.company_id,name:a.value.name,start_at:a.value.start_at,end_at:a.value.end_at,intro_email_text:(t=a.value.intro_email_text)!=null?t:"",welcome_email_text:(e=a.value.welcome_email_text)!=null?e:"",finish_email_text:(b=a.value.finish_email_text)!=null?b:"",is_link_generated_by_excel:a.value.is_link_generated_by_excel},W=await w.updateCampaign(f.value,L);return N(d,{message:"Campagna aggiornata correttamente.",title:""}),ie(),j.replace({name:"campagne"}),r(),W}catch(L){r(),U(d,L)}},Le=async function(){s();try{a.value.template_questionnaire_id=T;const t=await w.createCampaign(a.value);return N(d,{message:"Campagna creata correttamente.",title:""}),j.replace({name:"campagne"}),r(),t}catch(t){r(),U(d,t)}},ze=function(){var t,e;a.value={...J.value},w.setSurveyCode((e=(t=a.value.survey_codes)==null?void 0:t[0])!=null?e:null)},qe=function(){re()||Me()||ue()||de()||K()||ce()||(f.value&&a.value.id?Te():Le())},ue=function(){var t,e;return((t=a.value)==null?void 0:t.start_at)==""||((e=a.value)==null?void 0:e.start_at)==null?h.value=!0:h.value=!1,h.value},de=function(){var t,e;return((t=a.value)==null?void 0:t.end_at)==""||((e=a.value)==null?void 0:e.end_at)==null?D.value=!0:D.value=!1,D.value},re=function(){var t,e;return((t=a.value)==null?void 0:t.name)==""||((e=a.value)==null?void 0:e.name)==null?m.value=!0:m.value=!1,m.value},Me=function(){return a.value.company?k.value=!1:k.value=!0,k.value},ce=function(){return!a.value.survey_codes||a.value.survey_codes.length===0?v.value=!0:v.value=!1,v.value},K=function(){return a.value.is_link_generated_by_excel?(x.value=!1,x.value):(a.value.audience?x.value=!1:x.value=!0,x.value)},$e=t=>{q.require({target:t.currentTarget,message:"Sei sicuro di voler mandare un recall agli utenti che non hanno ancora compilato il questionario?",icon:"pi pi-info-circle",acceptClass:"p-button-warning",accept:()=>{Re()}})},Ee=t=>{q.require({target:t.currentTarget,message:"Sei sicuro di voler inviare le credenziali?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{Be()}})},Be=async function(){try{if(!a.value.id)return;await w.sendCredentials(a.value.id),N(d,{message:"Credenziali inviate correttamente.",title:""})}catch(t){U(d,t)}},Re=async function(){try{if(!a.value.id)return;await w.sendRecall(a.value.id),N(d,{message:"Recall inviato correttamente.",title:""})}catch(t){U(d,t)}},Ye=function(){K()},Ne=function(t){t?(a.value.company_id=t.id,a.value.company=t):(delete a.value.company,delete a.value.company_id)},Ge=function(t){t?(a.value.audience_id=t.id,a.value.audience=t):(delete a.value.audience,delete a.value.audience_id),K()};return be(async()=>{f.value=C.params.campaign_id?C.params.campaign_id:null,f.value?(await ie(),I.value[0]={label:"Modifica campagna"}):I.value[0]={label:"Nuova campagna"}}),(t,e)=>{const b=i("Breadcrumb"),L=i("Button"),W=i("InputText"),G=i("Checkbox"),me=i("Calendar"),Z=i("Textarea"),H=i("TabPanel"),Fe=i("Dropdown"),Pe=i("TabView"),je=i("Card"),Qe=i("ConfirmPopup");return u(),_("div",ya,[o(b,{home:V.value,model:I.value,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),o(je,null,{content:A(()=>[l("div",ba,[e[19]||(e[19]=l("h1",null,"CAMPAGNA",-1)),a.value.id&&a.value.status!="finished"?(u(),_("div",Ca,[o(L,{label:"INVIA RECALL",class:"p-button-outlined p-button-warning mr-3",onClick:e[0]||(e[0]=n=>$e(n))}),o(L,{label:"INVIA CREDENZIALI",class:"p-button-outlined p-button-danger",onClick:e[1]||(e[1]=n=>Ee(n))})])):c("v-if",!0)]),o(Pe,null,{default:A(()=>[o(H,{header:"Dati campagna"},{default:A(()=>[l("div",xa,[l("div",wa,[e[20]||(e[20]=l("label",{for:"name"},"Nome campagna*",-1)),o(W,{id:"name",type:"text",modelValue:a.value.name,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.name=n),class:M(["w-full",{"p-invalid":m.value}]),onChange:re},null,8,["modelValue","class"]),m.value?(u(),_("small",Va,"Campo obbligatorio.")):c("v-if",!0)]),l("div",ka,[e[21]||(e[21]=l("label",{for:"company"},"Azienda*",-1)),o(pe,{id:"company","model-value":a.value.company,suggestions:g(oe),class:M({"p-invalid":k.value}),"onUpdate:suggestions":e[3]||(e[3]=n=>oe.value=n),"onUpdate:modelValue":Ne,onFirstFetch:e[4]||(e[4]=n=>g(ke)(n)),onFetchMore:e[5]||(e[5]=n=>g(De)(n)),"is-loading":g(Ae),disabled:f.value},null,8,["model-value","suggestions","class","is-loading","disabled"]),k.value?(u(),_("small",Da,"Campo obbligatorio.")):c("v-if",!0)]),l("div",Aa,[e[22]||(e[22]=l("label",{for:"audience"},"Audience*",-1)),o(pe,{id:"audience","model-value":a.value.audience,suggestions:g(se),"onUpdate:suggestions":e[6]||(e[6]=n=>se.value=n),"onUpdate:modelValue":Ge,onFirstFetch:e[7]||(e[7]=n=>g(Se)(n)),onFetchMore:e[8]||(e[8]=n=>g(Ue)(n)),"is-loading":g(Ie),class:M({"p-invalid":x.value}),disabled:a.value.status==="active"||a.value.is_link_generated_by_excel},null,8,["model-value","suggestions","is-loading","class","disabled"]),x.value?(u(),_("small",ha,"Campo obbligatorio.")):c("v-if",!0)]),l("div",Sa,[o(G,{modelValue:a.value.is_link_generated_by_excel,"onUpdate:modelValue":[e[9]||(e[9]=n=>a.value.is_link_generated_by_excel=n),Ye],inputId:"excel",binary:!0,disabled:a.value.status==="active"},null,8,["modelValue","disabled"]),e[23]||(e[23]=l("label",{for:"excel",class:"ml-2"},"Genera accessi in Excel ",-1))]),e[32]||(e[32]=l("div",{class:"field col-6"},null,-1)),l("div",Ua,[l("div",Ia,[e[24]||(e[24]=l("label",{for:"start_at"},"Data inizio*",-1)),o(me,{inputId:"start_at",modelValue:le.value,"onUpdate:modelValue":e[10]||(e[10]=n=>le.value=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:"gg/mm/aaaa",id:"start_at",class:M({"p-invalid":h.value}),onChange:ue},null,8,["modelValue","class"]),h.value?(u(),_("small",Ta,"Campo obbligatorio.")):c("v-if",!0)]),l("div",La,[e[25]||(e[25]=l("label",{for:"end_at"},"Data fine*",-1)),o(me,{inputId:"end_at",modelValue:ne.value,"onUpdate:modelValue":e[11]||(e[11]=n=>ne.value=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:"gg/mm/aaaa",id:"end_at",class:M({"p-invalid":D.value}),onChange:de},null,8,["modelValue","class"]),D.value?(u(),_("small",za,"Campo obbligatorio.")):c("v-if",!0)])]),l("div",qa,[l("div",Ma,[e[26]||(e[26]=l("label",{for:"note"},"Intro questionario",-1)),o(Z,{id:"note",modelValue:a.value.intro_email_text,"onUpdate:modelValue":e[12]||(e[12]=n=>a.value.intro_email_text=n),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])]),l("div",$a,[e[27]||(e[27]=l("label",{for:"note"},"Intro email",-1)),o(Z,{id:"note",modelValue:a.value.welcome_email_text,"onUpdate:modelValue":e[13]||(e[13]=n=>a.value.welcome_email_text=n),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])]),l("div",Ea,[e[28]||(e[28]=l("label",{for:"note"},"Fine email",-1)),o(Z,{id:"note",modelValue:a.value.finish_email_text,"onUpdate:modelValue":e[14]||(e[14]=n=>a.value.finish_email_text=n),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])]),l("div",Ba,[l("div",null,[o(G,{disabled:!!f.value,modelValue:g(B),"onUpdate:modelValue":e[15]||(e[15]=n=>X(B)?B.value=n:null),inputId:"win",binary:!0},null,8,["disabled","modelValue"]),e[29]||(e[29]=l("label",{for:"excel",class:"mx-2"},"Rilevazione dei bisogni",-1))]),l("div",null,[o(G,{disabled:!!f.value,modelValue:g(R),"onUpdate:modelValue":e[16]||(e[16]=n=>X(R)?R.value=n:null),inputId:"climate",binary:!0},null,8,["disabled","modelValue"]),e[30]||(e[30]=l("label",{for:"excel",class:"mx-2"},"Clima ",-1))]),l("div",null,[o(G,{disabled:!!f.value,modelValue:g(S),"onUpdate:modelValue":e[17]||(e[17]=n=>X(S)?S.value=n:null),inputId:"impact",binary:!0},null,8,["disabled","modelValue"]),e[31]||(e[31]=l("label",{for:"excel",class:"mx-2"},"Analisi di impatto ",-1))]),v.value?(u(),_("small",Ra,"Selezionare almeno un questionario")):c("v-if",!0)])])])]),_:1}),o(H,{header:"Domande",disabled:!a.value.id},{default:A(()=>[l("div",Ya,[l("div",Na,[e[33]||(e[33]=l("label",{for:"note"},"Questionario",-1)),o(Fe,{class:"w-full",options:a.value.survey_codes,"option-label":n=>g(Xe)(n),"model-value":Y.value,"onUpdate:modelValue":e[18]||(e[18]=n=>g(w).setSurveyCode(n))},null,8,["options","option-label","model-value"])])]),Y.value?(u(),$(ua,{key:0,questions:we.value,survey_code:Y.value},null,8,["questions","survey_code"])):c("v-if",!0)]),_:1},8,["disabled"]),a.value.is_link_generated_by_excel?(u(),$(H,{key:0,header:"Genera utenze",disabled:!a.value.id},{default:A(()=>{var n;return[(n=J.value)!=null&&n.id?(u(),$(ga,{key:0,campaign_detail:J.value},null,8,["campaign_detail"])):c("v-if",!0)]}),_:1},8,["disabled"])):c("v-if",!0)]),_:1}),l("div",Ga,[o(L,{label:"Salva",onClick:qe})])]),_:1}),o(Qe)])}}});const Wa=te(Fa,[["__file","/Users/giacomo/Developer/tandu/wala/wala-gestionale-aziende/wala-gestionale-aziende/src/views/campaigns/CampaignsDetailView.vue"]]);export{Wa as default};
